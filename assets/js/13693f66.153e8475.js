"use strict";(self.webpackChunkkuberocketci_docs=self.webpackChunkkuberocketci_docs||[]).push([[62231],{30262:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>p,contentTitle:()=>l,default:()=>c,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"operator-guide/upgrade/upgrade-edp-3.0","title":"Upgrade EDP v2.12 to 3.0","description":"Comprehensive guide on upgrading EDP to version 3.0, addressing prerequisites, Keycloak integration adjustments, and steps for migrating from Jenkins to Tekton CI pipelines.","source":"@site/versioned_docs/version-3.10/operator-guide/upgrade/upgrade-edp-3.0.md","sourceDirName":"operator-guide/upgrade","slug":"/operator-guide/upgrade/upgrade-edp-3.0","permalink":"/docs/operator-guide/upgrade/upgrade-edp-3.0","draft":false,"unlisted":false,"editUrl":"https://github.com/KubeRocketCI/docs/edit/main/docs/operator-guide/upgrade/upgrade-edp-3.0.md","tags":[],"version":"3.10","lastUpdatedBy":"Sergiy Kulanov","lastUpdatedAt":1740847812000,"frontMatter":{"title":"Upgrade EDP v2.12 to 3.0","description":"Comprehensive guide on upgrading EDP to version 3.0, addressing prerequisites, Keycloak integration adjustments, and steps for migrating from Jenkins to Tekton CI pipelines.","sidebar_label":"Upgrade EDP to 3.0"},"sidebar":"operatorGuideSidebar","previous":{"title":"Upgrade EDP to 3.1","permalink":"/docs/operator-guide/upgrade/upgrade-edp-3.1"},"next":{"title":"Upgrade Keycloak to 19.0","permalink":"/docs/operator-guide/upgrade/upgrade-keycloak-19.0"}}');var s=n(74848),r=n(28453);const o={title:"Upgrade EDP v2.12 to 3.0",description:"Comprehensive guide on upgrading EDP to version 3.0, addressing prerequisites, Keycloak integration adjustments, and steps for migrating from Jenkins to Tekton CI pipelines.",sidebar_label:"Upgrade EDP to 3.0"},l="Upgrade EDP v2.12 to 3.0",p={},d=[{value:"Related Articles",id:"related-articles",level:2}];function i(e){const a={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components},{Details:n,Head:t}=a;return n||m("Details",!0),t||m("Head",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(a.header,{children:(0,s.jsx)(a.h1,{id:"upgrade-edp-v212-to-30",children:"Upgrade EDP v2.12 to 3.0"})}),"\n",(0,s.jsx)(t,{children:(0,s.jsx)("link",{rel:"canonical",href:"https://docs.kuberocketci.io/docs/operator-guide/upgrade/upgrade-edp-3.0"})}),"\n",(0,s.jsxs)(a.admonition,{type:"warning",children:[(0,s.jsx)(a.p,{children:"Please read carefully the following notes before upgrading EDP to 3.0:"}),(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsx)(a.li,{children:"Before starting the upgrade procedure, please make the necessary backups."}),"\n",(0,s.jsxs)(a.li,{children:["Kiosk integration is disabled by default. With EDP below v.3.0.x, define the ",(0,s.jsx)(a.code,{children:"global.kioskEnabled"})," parameter in the ",(0,s.jsx)(a.a,{href:"https://github.cm/epam/edp-install/blob/release/3.0/deploy-templates/values.yaml",children:"values.yaml"})," file."]}),"\n",(0,s.jsxs)(a.li,{children:["The ",(0,s.jsx)(a.code,{children:"gerrit-ssh-port"})," parameter is moved from the ",(0,s.jsx)(a.code,{children:"gerrit-operator.gerrit.sshport"})," to ",(0,s.jsx)(a.code,{children:"global.gerritSSHPort"})," ",(0,s.jsx)(a.a,{href:"https://github.com/epam/edp-install/blob/master/deploy-templates/values.yaml#L30",children:"values.yaml"})," file."]}),"\n",(0,s.jsxs)(a.li,{children:["In edp-gerrit-operator, the ",(0,s.jsx)(a.code,{children:"gitServer.user"})," value is changed from the ",(0,s.jsx)(a.code,{children:"jenkins"})," to ",(0,s.jsx)(a.code,{children:"edp-ci"}),(0,s.jsx)(a.a,{href:"https://github.com/epam/edp-gerrit-operator/blob/release/2.13/deploy-templates/values.yaml#L96",children:"values.yaml"})," file."]}),"\n"]})]}),"\n",(0,s.jsx)(a.p,{children:"This section provides the details on upgrading EDP to 3.0. Explore the actions and requirements below."}),"\n",(0,s.jsxs)(a.ol,{children:["\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"Update Custom Resource Definitions (CRDs). Run the following command to apply all necessary CRDs to the cluster:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"kubectl apply -f https://raw.githubusercontent.com/epam/edp-gerrit-operator/d9a4d15244c527ef6d1d029af27574282a281b98/deploy-templates/crds/v2.edp.epam.com_gerrits.yaml\nkubectl apply -f https://raw.githubusercontent.com/epam/edp-codebase-operator/release/2.14/deploy-templates/crds/v2.edp.epam.com_cdstagedeployments.yaml\nkubectl apply -f https://raw.githubusercontent.com/epam/edp-codebase-operator/release/2.14/deploy-templates/crds/v2.edp.epam.com_codebasebranches.yaml\nkubectl apply -f https://raw.githubusercontent.com/epam/edp-codebase-operator/release/2.14/deploy-templates/crds/v2.edp.epam.com_codebaseimagestreams.yaml\nkubectl apply -f https://raw.githubusercontent.com/epam/edp-codebase-operator/release/2.14/deploy-templates/crds/v2.edp.epam.com_codebases.yaml\nkubectl apply -f https://raw.githubusercontent.com/epam/edp-codebase-operator/release/2.14/deploy-templates/crds/v2.edp.epam.com_gitservers.yaml\nkubectl apply -f https://raw.githubusercontent.com/epam/edp-codebase-operator/release/2.14/deploy-templates/crds/v2.edp.epam.com_gittags.yaml\nkubectl apply -f https://raw.githubusercontent.com/epam/edp-codebase-operator/release/2.14/deploy-templates/crds/v2.edp.epam.com_imagestreamtags.yaml\nkubectl apply -f https://raw.githubusercontent.com/epam/edp-codebase-operator/release/2.14/deploy-templates/crds/v2.edp.epam.com_jiraissuemetadatas.yaml\nkubectl apply -f https://raw.githubusercontent.com/epam/edp-codebase-operator/release/2.14/deploy-templates/crds/v2.edp.epam.com_jiraservers.yaml\nkubectl apply -f https://raw.githubusercontent.com/epam/edp-keycloak-operator/release/1.14/deploy-templates/crds/v1.edp.epam.com_keycloakauthflows.yaml\nkubectl apply -f https://raw.githubusercontent.com/epam/edp-keycloak-operator/release/1.14/deploy-templates/crds/v1.edp.epam.com_keycloakclients.yaml\nkubectl apply -f https://raw.githubusercontent.com/epam/edp-keycloak-operator/release/1.14/deploy-templates/crds/v1.edp.epam.com_keycloakclientscopes.yaml\nkubectl apply -f https://raw.githubusercontent.com/epam/edp-keycloak-operator/release/1.14/deploy-templates/crds/v1.edp.epam.com_keycloakrealmcomponents.yaml\nkubectl apply -f https://raw.githubusercontent.com/epam/edp-keycloak-operator/release/1.14/deploy-templates/crds/v1.edp.epam.com_keycloakrealmgroups.yaml\nkubectl apply -f https://raw.githubusercontent.com/epam/edp-keycloak-operator/release/1.14/deploy-templates/crds/v1.edp.epam.com_keycloakrealmidentityproviders.yaml\nkubectl apply -f https://raw.githubusercontent.com/epam/edp-keycloak-operator/release/1.14/deploy-templates/crds/v1.edp.epam.com_keycloakrealmrolebatches.yaml\nkubectl apply -f https://raw.githubusercontent.com/epam/edp-keycloak-operator/release/1.14/deploy-templates/crds/v1.edp.epam.com_keycloakrealmroles.yaml\nkubectl apply -f https://raw.githubusercontent.com/epam/edp-keycloak-operator/release/1.14/deploy-templates/crds/v1.edp.epam.com_keycloakrealms.yaml\nkubectl apply -f https://raw.githubusercontent.com/epam/edp-keycloak-operator/release/1.14/deploy-templates/crds/v1.edp.epam.com_keycloakrealmusers.yaml\nkubectl apply -f https://raw.githubusercontent.com/epam/edp-keycloak-operator/release/1.14/deploy-templates/crds/v1.edp.epam.com_keycloaks.yaml\n"})}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsxs)(a.p,{children:["Set the required parameters. For more details, please refer to the ",(0,s.jsx)(a.a,{href:"https://github.com/epam/edp-install/blob/release/3.0/deploy-templates/values.yaml",children:"values.yaml"})," file."]}),"\n",(0,s.jsxs)(n,{children:[(0,s.jsx)("summary",{children:(0,s.jsx)("b",{children:"View: values.yaml"})}),(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-yaml",children:"edp-tekton:\n  enabled: false\nadmin-console-operator:\n  enabled: true\njenkins-operator:\n  enabled: true\n"})})]}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"Add proper Helm annotations and labels as indicated below. This step is necessary starting from the release v.3.0.x as custom resources are managed by Helm and removed from the Keycloak Controller logic."}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"kubectl label EDPComponent main-keycloak app.kubernetes.io/managed-by=Helm -n <edp-namespace>\nkubectl annotate EDPComponent main-keycloak meta.helm.sh/release-name=<edp-release-name> -n <edp-namespace>\nkubectl annotate EDPComponent main-keycloak meta.helm.sh/release-namespace=<edp-namespace> -n <edp-namespace>\nkubectl label KeycloakRealm main app.kubernetes.io/managed-by=Helm -n <edp-namespace>\nkubectl annotate KeycloakRealm main meta.helm.sh/release-name=<edp-release-name> -n <edp-namespace>\nkubectl annotate KeycloakRealm main meta.helm.sh/release-namespace=<edp-namespace> -n <edp-namespace>\n"})}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"To upgrade EDP to 3.0, run the following command:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"helm upgrade edp epamedp/edp-install -n \\<edp-namespace\\> --values values.yaml --version=3.0.x\n"})}),"\n",(0,s.jsx)(a.admonition,{type:"note",children:(0,s.jsxs)(a.p,{children:["To verify the installation, it is possible to test the deployment before applying it to the cluster with the following command:",(0,s.jsx)("br",{}),"\n",(0,s.jsx)(a.code,{children:"helm upgrade edp epamedp/edp-install -n <edp-namespace> --values values.yaml --version=3.0.x  --dry-run"})]})}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsxs)(a.p,{children:["Update image versions for the Jenkins agents in the ",(0,s.jsx)(a.em,{children:"ConfigMap"}),":"]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"  kubectl edit configmap jenkins-slaves -n <edp-namespace>\n"})}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"The versions of the images must be the following:"}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"epamedp/edp-jenkins-codenarc-agent:3.0.10\nepamedp/edp-jenkins-dotnet-31-agent:3.0.9\nepamedp/edp-jenkins-go-agent:3.0.17\nepamedp/edp-jenkins-gradle-java11-agent:3.0.7\nepamedp/edp-jenkins-gradle-java8-agent:3.0.10\nepamedp/edp-jenkins-helm-agent:3.0.11\nepamedp/edp-jenkins-kaniko-docker-agent:1.0.9\nepamedp/edp-jenkins-maven-java11-agent:3.0.7\nepamedp/edp-jenkins-maven-java8-agent:3.0.10\nepamedp/edp-jenkins-npm-agent:3.0.9\nepamedp/edp-jenkins-opa-agent:3.0.7\nepamedp/edp-jenkins-python-38-agent:3.0.8\nepamedp/edp-jenkins-sast-agent:0.1.5\nepamedp/edp-jenkins-terraform-agent:3.0.9\n"})}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsxs)(a.p,{children:["Remove the ",(0,s.jsx)(a.code,{children:"edp-jenkins-dotnet-21-agent"})," agent manifest."]}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsx)(a.p,{children:"Restart the Jenkins pod."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsxs)(a.p,{children:["Attach the ",(0,s.jsx)(a.code,{children:"id_rsa.pub"})," SSH public key from the ",(0,s.jsx)(a.code,{children:"gerrit-ciuser-sshkey"})," secret to the ",(0,s.jsx)(a.code,{children:"edp-ci"})," Gerrit user in the ",(0,s.jsx)(a.code,{children:"gerrit"})," pod:"]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:"ssh -p <gerrit_ssh_port> <host> gerrit set-account --add-ssh-key ~/id_rsa.pub\n"})}),"\n",(0,s.jsx)(a.admonition,{type:"note",children:(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsxs)(a.li,{children:["For this operation, use the ",(0,s.jsx)(a.code,{children:"gerrit-admin"})," SSH key from secrets."]}),"\n",(0,s.jsxs)(a.li,{children:[(0,s.jsx)(a.code,{children:"<host>"})," is admin@localhost or any other user with permissions."]}),"\n"]})}),"\n"]}),"\n",(0,s.jsxs)(a.li,{children:["\n",(0,s.jsxs)(a.p,{children:["Change the username from ",(0,s.jsx)(a.code,{children:"jenkins"})," to ",(0,s.jsx)(a.code,{children:"edp-ci"})," in the ",(0,s.jsx)(a.code,{children:"gerrit-ciuser-sshkey"})," secret:"]}),"\n",(0,s.jsx)(a.pre,{children:(0,s.jsx)(a.code,{className:"language-bash",children:'kubectl -n <edp-namespace> patch secret gerrit-ciuser-sshkey\\\n  --patch="{\\"data\\": { \\"username\\": \\"$(echo -n edp-ci |base64 -w0)\\" }}" -o yaml\n'})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(a.admonition,{type:"warning",children:(0,s.jsxs)(a.p,{children:["In EDP v.3.0.x, ",(0,s.jsx)(a.a,{href:"/docs/user-guide/",children:"Admin Console"})," is deprecated, and EDP interface is available only via ",(0,s.jsx)(a.a,{href:"/docs/user-guide/",children:"EDP Portal"}),"."]})}),"\n",(0,s.jsx)(a.h2,{id:"related-articles",children:"Related Articles"}),"\n",(0,s.jsxs)(a.ul,{children:["\n",(0,s.jsx)(a.li,{children:(0,s.jsx)(a.a,{href:"/docs/operator-guide/upgrade/migrate-ci-pipelines-from-jenkins-to-tekton",children:"Migrate CI Pipelines From Jenkins to Tekton"})}),"\n"]})]})}function c(e={}){const{wrapper:a}={...(0,r.R)(),...e.components};return a?(0,s.jsx)(a,{...e,children:(0,s.jsx)(i,{...e})}):i(e)}function m(e,a){throw new Error("Expected "+(a?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},28453:(e,a,n)=>{n.d(a,{R:()=>o,x:()=>l});var t=n(96540);const s={},r=t.createContext(s);function o(e){const a=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(a):{...a,...e}}),[a,e])}function l(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(r.Provider,{value:a},e.children)}}}]);