"use strict";(self.webpackChunkkuberocketci_docs=self.webpackChunkkuberocketci_docs||[]).push([[15399],{1544:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/sonarqube-create-user-d5079fc985744e10ea3b6ef5c179ad8c.png"},9380:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/opensearch-security-5de58c44bfad259e9d13341db92fc387.png"},9891:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/dependency-track-team-details-5803ad6c09b3177f50816e26f55f766f.png"},11470:(e,n,t)=>{t.d(n,{A:()=>A});var r=t(96540),s=t(34164),a=t(17559),i=t(23104),o=t(56347),c=t(205),l=t(57485),d=t(31682),h=t(70679);function u(e){return r.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function p(e){const{values:n,children:t}=e;return(0,r.useMemo)(()=>{const e=n??function(e){return u(e).map(({props:{value:e,label:n,attributes:t,default:r}})=>({value:e,label:n,attributes:t,default:r}))}(t);return function(e){const n=(0,d.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,t])}function g({value:e,tabValues:n}){return n.some(n=>n.value===e)}function x({queryString:e=!1,groupId:n}){const t=(0,o.W6)(),s=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,l.aZ)(s),(0,r.useCallback)(e=>{if(!s)return;const n=new URLSearchParams(t.location.search);n.set(s,e),t.replace({...t.location,search:n.toString()})},[s,t])]}function m(e){const{defaultValue:n,queryString:t=!1,groupId:s}=e,a=p(e),[i,o]=(0,r.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!g({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find(e=>e.default)??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:a})),[l,d]=x({queryString:t,groupId:s}),[u,m]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,s]=(0,h.Dv)(n);return[t,(0,r.useCallback)(e=>{n&&s.set(e)},[n,s])]}({groupId:s}),j=(()=>{const e=l??u;return g({value:e,tabValues:a})?e:null})();(0,c.A)(()=>{j&&o(j)},[j]);return{selectedValue:i,selectValue:(0,r.useCallback)(e=>{if(!g({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);o(e),d(e),m(e)},[d,m,a]),tabValues:a}}var j=t(92303);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=t(74848);function k({className:e,block:n,selectedValue:t,selectValue:r,tabValues:a}){const o=[],{blockElementScrollPositionUntilNextRender:c}=(0,i.a_)(),l=e=>{const n=e.currentTarget,s=o.indexOf(n),i=a[s].value;i!==t&&(c(n),r(i))},d=e=>{let n=null;switch(e.key){case"Enter":l(e);break;case"ArrowRight":{const t=o.indexOf(e.currentTarget)+1;n=o[t]??o[0];break}case"ArrowLeft":{const t=o.indexOf(e.currentTarget)-1;n=o[t]??o[o.length-1];break}}n?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":n},e),children:a.map(({value:e,label:n,attributes:r})=>(0,b.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{o.push(e)},onKeyDown:d,onClick:l,...r,className:(0,s.A)("tabs__item",f.tabItem,r?.className,{"tabs__item--active":t===e}),children:n??e},e))})}function y({lazy:e,children:n,selectedValue:t}){const a=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=a.find(e=>e.props.value===t);return e?(0,r.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:a.map((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==t}))})}function v(e){const n=m(e);return(0,b.jsxs)("div",{className:(0,s.A)(a.G.tabs.container,"tabs-container",f.tabList),children:[(0,b.jsx)(k,{...n,...e}),(0,b.jsx)(y,{...n,...e})]})}function A(e){const n=(0,j.A)();return(0,b.jsx)(v,{...e,children:u(e.children)},String(n))}},14011:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/dependency-track-create-team-ee68acb7e924ed48366973e7de170c1c.png"},19365:(e,n,t)=>{t.d(n,{A:()=>i});t(96540);var r=t(34164);const s={tabItem:"tabItem_Ymn6"};var a=t(74848);function i({children:e,hidden:n,className:t}){return(0,a.jsx)("div",{role:"tabpanel",className:(0,r.A)(s.tabItem,t),hidden:n,children:e})}},20243:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/dependency-track-access-management-9425b5cdcd6cbea623a48ddb50c0979b.png"},25690:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"operator-guide/extensions/krakend","title":"KrakenD Integration","description":"Integrate KrakenD with KubeRocketCI for enhanced API management, including service discovery, caching, and security features like JWT authentication.","source":"@site/docs/operator-guide/extensions/krakend.md","sourceDirName":"operator-guide/extensions","slug":"/operator-guide/extensions/krakend","permalink":"/docs/next/operator-guide/extensions/krakend","draft":false,"unlisted":false,"editUrl":"https://github.com/KubeRocketCI/docs/edit/main/docs/operator-guide/extensions/krakend.md","tags":[],"version":"current","lastUpdatedBy":"Daniil Nedostup","lastUpdatedAt":1754645345000,"frontMatter":{"title":"KrakenD Integration","description":"Integrate KrakenD with KubeRocketCI for enhanced API management, including service discovery, caching, and security features like JWT authentication.","sidebar_label":"KrakenD"},"sidebar":"operatorGuideSidebar","previous":{"title":"Custom Certificates","permalink":"/docs/next/operator-guide/advanced-installation/custom-certificates"},"next":{"title":"GitFusion","permalink":"/docs/next/operator-guide/extensions/git-discovery"}}');var s=t(74848),a=t(28453);t(11470),t(19365);const i={title:"KrakenD Integration",description:"Integrate KrakenD with KubeRocketCI for enhanced API management, including service discovery, caching, and security features like JWT authentication.",sidebar_label:"KrakenD"},o="KrakenD Integration",c={},l=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Installation",id:"installation",level:2},{value:"Approach 1: Deploy Using Argo CD",id:"approach-1-deploy-using-argo-cd",level:3},{value:"Approach 2: Deploy Using Helm",id:"approach-2-deploy-using-helm",level:3},{value:"Create Access Tokens",id:"create-access-tokens",level:2},{value:"SonarQube",id:"sonarqube",level:3},{value:"Dependency-Track",id:"dependency-track",level:3},{value:"OpenSearch",id:"opensearch",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Related Articles",id:"related-articles",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components},{Head:r}=n;return r||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Head",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"krakend-integration",children:"KrakenD Integration"})}),"\n",(0,s.jsx)(r,{children:(0,s.jsx)("link",{rel:"canonical",href:"https://docs.kuberocketci.io/docs/operator-guide/extensions/krakend"})}),"\n",(0,s.jsxs)(n.p,{children:["This guide explains how to integrate KrakenD with KubeRocketCI. ",(0,s.jsx)(n.a,{href:"https://www.krakend.io/docs/",children:"KrakenD"})," is a fast, open-source API gateway that helps manage requests, protect sensitive data, and optimize routing. It offers options for service discovery, caching, authorization, and rate limiting, which can be customized for the platform."]}),"\n",(0,s.jsx)(n.p,{children:"KubeRocketCI uses KrakenD to connect with services like SonarQube, Dependency-Track, OpenSearch, and GitFusion. This integration allows the platform to fetch data from these services and show it in the KubeRocketCI portal, giving users a clear view of their projects and pipelines. For enhanced security, KrakenD uses JWT tokens from Identity Providers (such as Keycloak or Microsoft Entra ID) to authenticate and authorize requests."}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsx)(n.p,{children:"To integrate KrakenD with KubeRocketCI, ensure the following prerequisites are met:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["An ",(0,s.jsx)(n.a,{href:"https://github.com/epam/edp-cluster-add-ons/tree/main/clusters/core/addons/ingress-nginx",children:"Ingress Controller"})," is installed and configured."]}),"\n",(0,s.jsxs)(n.li,{children:["A ",(0,s.jsx)(n.a,{href:"/docs/next/operator-guide/auth/keycloak",children:"Keycloak"})," instance is installed and configured with the necessary settings from the ",(0,s.jsx)(n.a,{href:"https://github.com/epam/edp-cluster-add-ons/tree/main/clusters/core/addons/kuberocketci-rbac",children:"kuberocketci-rbac"})," repository."]}),"\n",(0,s.jsxs)(n.li,{children:["A ",(0,s.jsx)(n.a,{href:"/docs/next/operator-guide/code-quality/sonarqube",children:"SonarQube"})," instance is installed and configured."]}),"\n",(0,s.jsxs)(n.li,{children:["A ",(0,s.jsx)(n.a,{href:"/docs/next/operator-guide/devsecops/dependency-track",children:"Dependency-Track"})," instance is installed and configured."]}),"\n",(0,s.jsxs)(n.li,{children:["(Optional) An ",(0,s.jsx)(n.a,{href:"https://github.com/epam/edp-cluster-add-ons/tree/main/clusters/core/addons/opensearch",children:"OpenSearch"})," instance is installed and configured (required for the ",(0,s.jsx)(n.a,{href:"/docs/next/operator-guide/ci/tekton-long-term-storage",children:"Long-Term Storage"})," feature)."]}),"\n",(0,s.jsxs)(n.li,{children:["(Optional) The ",(0,s.jsx)(n.a,{href:"https://github.com/epam/edp-cluster-add-ons/tree/main/clusters/core/addons/external-secrets",children:"External Secrets Operator"})," is installed."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,s.jsxs)(n.p,{children:["There are two approaches to install KrakenD using ",(0,s.jsx)(n.a,{href:"https://github.com/epam/edp-cluster-add-ons",children:"edp-cluster-add-ons"})," repository:"]}),"\n",(0,s.jsx)(n.h3,{id:"approach-1-deploy-using-argo-cd",children:"Approach 1: Deploy Using Argo CD"}),"\n",(0,s.jsx)(n.p,{children:"The first approach is to deploy KrakenD using Argo CD. Follow the steps below to install KrakenD using Argo CD:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Clone the forked ",(0,s.jsx)(n.a,{href:"https://github.com/epam/edp-cluster-add-ons",children:"edp-cluster-add-ons"})," repository."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Navigate to the ",(0,s.jsx)(n.code,{children:"clusters/core/addons/krakend"})," directory and configure the ",(0,s.jsx)(n.code,{children:"values.yaml"})," file with the necessary values for the KrakenD installation."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["After configuring the KrakenD Helm chart values, navigate to the ",(0,s.jsx)(n.code,{children:"clusters/core/apps"})," directory. In the ",(0,s.jsx)(n.code,{children:"values.yaml"})," file, update the ",(0,s.jsx)(n.code,{children:"krakend"})," section by specifying the ",(0,s.jsx)(n.code,{children:"enable"})," field as ",(0,s.jsx)(n.code,{children:"true"})," to enable Argo CD Application creation for the KrakenD:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"krakend:\n  enable: true\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Commit and push the changes to the remote repository. After the changes are pushed, navigate to the Argo CD and sync the KrakenD application. Verify that the KrakenD is successfully deployed:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Argo CD KrakenD",src:t(80311).A+"",width:"3364",height:"1660"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"approach-2-deploy-using-helm",children:"Approach 2: Deploy Using Helm"}),"\n",(0,s.jsx)(n.p,{children:"The second approach is to deploy KrakenD using Helm. Follow the steps below to install KrakenD using Helm:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Clone the forked ",(0,s.jsx)(n.a,{href:"https://github.com/epam/edp-cluster-add-ons",children:"edp-cluster-add-ons"})," repository."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Navigate to the ",(0,s.jsx)(n.code,{children:"clusters/core/addons/krakend"})," directory and configure the ",(0,s.jsx)(n.code,{children:"values.yaml"})," file with the necessary values for the KrakenD installation."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"After configuring the KrakenD Helm chart values, run the following command to deploy the KrakenD:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"helm upgrade --install krakend . -n krakend --create-namespace\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Verify that the KrakenD is successfully deployed."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"create-access-tokens",children:"Create Access Tokens"}),"\n",(0,s.jsx)(n.p,{children:"To integrate KrakenD with KubeRocketCI, it is necessary to create access tokens for the services that KrakenD will connect to. Follow the guides below to generate the necessary tokens for each service:"}),"\n",(0,s.jsx)(n.h3,{id:"sonarqube",children:"SonarQube"}),"\n",(0,s.jsx)(n.p,{children:"To generate an access token for SonarQube, follow the steps below:"}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:['It is also possible to use the existing SonarQube user "view-user" to generate an access token. This user is created by default during the ',(0,s.jsx)(n.a,{href:"https://github.com/epam/edp-cluster-add-ons/blob/main/clusters/core/addons/sonar-operator/templates/sonar/user_view.yaml",children:"sonar-operator"})," installation process."]})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Log in to SonarQube as an administrator:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"SonarQube Login",src:t(91503).A+"",width:"3364",height:"1660"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Navigate to the ",(0,s.jsx)(n.strong,{children:"Administration"})," tab and click ",(0,s.jsx)(n.strong,{children:"Security"}),". Select ",(0,s.jsx)(n.strong,{children:"Users"})," to navigate to the user management page:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"SonarQube Administration",src:t(68884).A+"",width:"3334",height:"1658"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["In the user management page, click the ",(0,s.jsx)(n.strong,{children:"Create User"})," button to create a new user:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"SonarQube Create User",src:t(1544).A+"",width:"3332",height:"1658"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Fill in the user details and click the ",(0,s.jsx)(n.strong,{children:"Create"})," button to create the user:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"SonarQube User Details",src:t(51762).A+"",width:"3364",height:"1660"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["After creating, find the user in the list and click the ",(0,s.jsx)(n.strong,{children:"Update Groups"})," button. In the opened dialog, navigate to the ",(0,s.jsx)(n.strong,{children:"Unselected"})," tab and select the checkbox for the ",(0,s.jsx)(n.strong,{children:"view-group"})," group. Click the ",(0,s.jsx)(n.strong,{children:"Reload"})," button to apply the changes:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"SonarQube Update Groups",src:t(53584).A+"",width:"3364",height:"1660"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["After updating the groups, click the ",(0,s.jsx)(n.strong,{children:"Update Tokens"})," button to generate a token for the user. Fill in the token name and click the ",(0,s.jsx)(n.strong,{children:"Generate"})," button to create the token. Copy the generated token for use in the KrakenD configuration:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"SonarQube Update Tokens",src:t(35182).A+"",width:"3364",height:"1660"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"After generating the token, save it in a secure location for further use."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"dependency-track",children:"Dependency-Track"}),"\n",(0,s.jsx)(n.p,{children:"To generate an access token for Dependency-Track, follow the steps below:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Log in to Dependency-Track as an administrator:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Dependency-Track Login",src:t(88558).A+"",width:"3364",height:"1660"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["In the left sidebar menu, navigate to the ",(0,s.jsx)(n.strong,{children:"Administration"})," tab. Click ",(0,s.jsx)(n.strong,{children:"Access Management"})," and select ",(0,s.jsx)(n.strong,{children:"Teams"}),":"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Dependency-Track Access Management",src:t(20243).A+"",width:"3332",height:"1658"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["In the team list, click the ",(0,s.jsx)(n.strong,{children:"Create Team"})," button to create a new team. Fill in the team name and click the ",(0,s.jsx)(n.strong,{children:"Create"})," button to create the team:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Dependency-Track Create Team",src:t(14011).A+"",width:"3364",height:"1660"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["After creating the team, click the team name to navigate to the team details. In the ",(0,s.jsx)(n.strong,{children:"Permissions"})," section, add the ",(0,s.jsx)(n.strong,{children:"VIEW_PORTFOLIO"})," permission. In the ",(0,s.jsx)(n.strong,{children:"API Keys"})," section, generate a new API key. Copy the generated API key for use in the KrakenD configuration:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Dependency-Track Team Details",src:t(9891).A+"",width:"3332",height:"1660"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"After generating the API key, save it in a secure location for further use."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"opensearch",children:"OpenSearch"}),"\n",(0,s.jsx)(n.p,{children:"In the case of OpenSearch, there is no need to generate an access token. Instead, the OpenSearch user credentials are used to authenticate requests. To create the user for KrakenD integration with OpenSearch, follow the steps below:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Log in to the OpenSearch instance as an administrator:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"OpenSearch Login",src:t(84735).A+"",width:"3364",height:"1660"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["In the left sidebar menu, navigate to the ",(0,s.jsx)(n.strong,{children:"Management"})," tab and select the ",(0,s.jsx)(n.strong,{children:"Security"})," section:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"OpenSearch Security",src:t(9380).A+"",width:"3364",height:"1660"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["In the security settings, select the ",(0,s.jsx)(n.strong,{children:"Internal users"})," tab and click ",(0,s.jsx)(n.strong,{children:"Create internal user"}),":"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"OpenSearch Internal Users",src:t(27450).A+"",width:"3364",height:"1660"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Fill in the username and password for the new user. In the ",(0,s.jsx)(n.strong,{children:"Backend roles"})," section, assign the ",(0,s.jsx)(n.strong,{children:"logstash"})," role. Click the ",(0,s.jsx)(n.strong,{children:"Create"})," button to create the user:"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"OpenSearch Create User",src:t(79740).A+"",width:"3364",height:"1660"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"After creating the user, save the username and password in a secure location for further use."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["It is highly recommended to use the ",(0,s.jsx)(n.a,{href:"https://github.com/epam/edp-cluster-add-ons",children:"edp-cluster-add-ons"})," repository to install and configure the necessary services for KrakenD integration.\nFor more details, refer to the ",(0,s.jsx)(n.a,{href:"/docs/next/operator-guide/add-ons-overview",children:"Installation via Add-Ons"})," page."]})}),"\n",(0,s.jsx)(n.p,{children:"To configure KrakenD as the API gateway for KubeRocketCI, follow the steps below:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Define the KrakenD API gateway URL:"}),"\n",(0,s.jsxs)(n.p,{children:["It is necessary to define the KrakenD API gateway URL during platform installation or update process. In the ",(0,s.jsx)(n.a,{href:"https://github.com/epam/edp-install",children:"edp-install"})," repository, specify the ",(0,s.jsx)(n.code,{children:"apiGatewayUrl"})," parameter in the ",(0,s.jsx)(n.code,{children:"global"})," section of the ",(0,s.jsx)(n.code,{children:"values.yaml"})," file:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'global:\n  apiGatewayUrl: "https://api.example.com"\n'})}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["This URL should point to the ingress URL of the KrakenD API Gateway. By default, this ",(0,s.jsx)(n.a,{href:"https://github.com/epam/edp-install/blob/v3.11.1/deploy-templates/values.yaml#L16",children:"value"})," is left empty, which means that the widgets are disabled by default."]})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Define the KrakenD secret:"}),"\n",(0,s.jsx)(n.p,{children:"To allow KrakenD to connect to the services, it is necessary to create a secret with the required credentials and URLs. The secret should contain the following fields:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"SONARQUBE_URL"}),": The URL of the SonarQube instance. For example: ",(0,s.jsx)(n.code,{children:"http://sonar.sonar:9000"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"SONARQUBE_TOKEN"}),": The access token, generated during the ",(0,s.jsx)(n.a,{href:"#sonarqube",children:"SonarQube Access Token creation"})," step. The token should be encoded in base64 format. To encode the token into Base64, execute the following command:"]}),"\n",(0,s.jsx)(n.admonition,{type:"warning",children:(0,s.jsxs)(n.p,{children:["It is necessary to add a colon ",(0,s.jsx)(n.code,{children:":"})," at the end of the token before encoding it."]})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'sonarqube_user_token="squ_19f5xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx46b6"\necho -n "${sonarqube_user_token}:" | base64\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"DEPTRACK_URL"}),": The API Server URL of the Dependency-Track instance. For example: ",(0,s.jsx)(n.code,{children:"http://dependency-track-api-server.dependency-track:8080"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"DEPTRACK_TOKEN"}),": The API key, generated during the ",(0,s.jsx)(n.a,{href:"#dependency-track",children:"Dependency-Track Access Token creation"})," step. Not required to encode in base64 format."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"OPENSEARCH_URL"}),": The URL of the OpenSearch instance. For example: ",(0,s.jsx)(n.code,{children:"https://opensearch-cluster-master.logging:9200"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"OPENSEARCH_CREDS"}),": The user credentials, created during the ",(0,s.jsx)(n.a,{href:"#opensearch",children:"OpenSearch User creation"})," step. The credentials should be encoded in base64 format. To encode the credentials into Base64, execute the following command:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'echo -n "admin:MySecurePass123" | base64\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"GITFUSION_URL"}),": The URL of the ",(0,s.jsx)(n.a,{href:"https://github.com/KubeRocketCI/gitfusion",children:"GitFusion"})," instance. For example: ",(0,s.jsx)(n.code,{children:"http://gitfusion.<krci-namespace>:8080"})]}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"<krci-namespace>"})," should be replaced with the actual namespace where GitFusion is deployed."]})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"JWK_URL"}),": The URL of the Identity Provider (Keycloak or Microsoft Entra ID) to fetch the JSON Web Key (JWK) set."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["For Keycloak, the URL should be in the following format: ",(0,s.jsx)(n.code,{children:"https://keycloak.example.com/auth/realms/<realmName>/protocol/openid-connect/certs"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["For Microsoft Entra ID, the URL should be in the following format: ",(0,s.jsx)(n.code,{children:"https://login.microsoftonline.com/common/discovery/v2.0/keys"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The secret can be specified in the following ways:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Using YAML manifest:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Secret\nmetadata:\n  name: krakend\n  namespace: krakend\ntype: Opaque\nstringData:\n  SONARQUBE_URL: http://sonar.sonar:9000\n  SONARQUBE_TOKEN: <sonarqube-token>\n  DEPTRACK_URL: http://dependency-track-api-server.dependency-track:8080\n  DEPTRACK_TOKEN: <dependency-track-token>\n  OPENSEARCH_URL: https://opensearch-cluster-master.logging:9200\n  OPENSEARCH_CREDS: <base64-encoded-credentials>\n  GITFUSION_URL: http://gitfusion.<krci-namespace>:8080\n  JWK_URL: https://keycloak.example.com/auth/realms/<realmName>/protocol/openid-connect/certs\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Using External Secrets Operator:"}),"\n",(0,s.jsx)(n.p,{children:"To define the secret using the External Secrets Operator, it is necessary to create an AWS Parameter Store object with the required fields. The object should contain the following fields:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:'title="AWS Parameter Store Object"',children:'{\n  "SONARQUBE_URL": "http://sonar.sonar:9000",\n  "SONARQUBE_TOKEN": "<sonarqube-token>",\n  "DEPTRACK_URL": "http://dependency-track-api-server.dependency-track:8080",\n  "DEPTRACK_TOKEN": "<dependency-track-token>",\n  "OPENSEARCH_URL": "https://opensearch-cluster-master.logging:9200",\n  "OPENSEARCH_CREDS": "<base64-encoded-credentials>",\n  "GITFUSION_URL": "http://gitfusion.<krci-namespace>:8080",\n  "JWK_URL": "https://keycloak.example.com/auth/realms/<realmName>/protocol/openid-connect/certs"\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Specify the External Secrets Operator configuration in ",(0,s.jsx)(n.code,{children:"values.yaml"})," file of the ",(0,s.jsx)(n.a,{href:"https://github.com/epam/edp-cluster-add-ons/blob/main/clusters/core/addons/krakend/values.yaml#L221",children:"KrakenD"})," Helm chart:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="values.yaml"',children:'eso:\n  # -- Install components of the ESO.\n  enabled: true\n  # -- Defines provider type. One of `aws` or `generic`.\n  type: "aws"\n  # -- Defines Secret Store name.\n  secretStoreName: "aws-parameterstore"\n  # -- Value name in AWS ParameterStore, AWS SecretsManager or other Secret Store.\n  secretName: "/infra/core/addons/krakend"\n  # -- Role ARN for the ExternalSecretOperator to assume.\n  roleArn: arn:aws:iam::012345678910:role/AWSIRSA_Shared_ExternalSecretOperatorAccess\n'})}),"\n",(0,s.jsxs)(n.p,{children:["More details about External Secrets Operator integration can be found in the ",(0,s.jsx)(n.a,{href:"/docs/next/operator-guide/secrets-management/install-external-secrets-operator",children:"External Secrets Operator"})," page."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"related-articles",children:"Related Articles"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/next/operator-guide/install-kuberocketci",children:"Install KubeRocketCI With Values File"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/next/operator-guide/add-ons-overview",children:"Install via Add-Ons"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/next/operator-guide/code-quality/sonarqube",children:"SonarQube Integration"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/next/operator-guide/devsecops/dependency-track",children:"Integrate DependencyTrack"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/next/operator-guide/auth/keycloak",children:"Install Keycloak"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/next/operator-guide/install-ingress-nginx",children:"Install NGINX Ingress Controller"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},27450:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/opensearch-internal-users-0a3f764d3c3bd19aa2adc62b17cfe6e1.png"},28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>o});var r=t(96540);const s={},a=r.createContext(s);function i(e){const n=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(a.Provider,{value:n},e.children)}},35182:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/sonarqube-update-tokens-e0a1553abe45d06752dd5f17e500383b.png"},51762:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/sonarqube-user-details-f60f9e5715dd9100130d7d463db285e8.png"},53584:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/sonarqube-update-groups-b5358c982a23e5ee65525095bbd1abad.png"},68884:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/sonarqube-administration-c0bae307285bc9703162cb41e4edffb7.png"},79740:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/opensearch-create-user-779f49da400e99d16dd5d2846809868a.png"},80311:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/argo-cd-krakend-0059299f6bd566b225cc9cf178cf6100.png"},84735:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/opensearch-login-page-b87e5ebf3c69ecba3b25b4a9c50064b3.png"},88558:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/dependency-track-login-bcff6b0f8b5977d8fdb840f0e386567f.png"},91503:(e,n,t)=>{t.d(n,{A:()=>r});const r=t.p+"assets/images/sonarqube-login-a578f945674bff277fc81a47d0983a66.png"}}]);