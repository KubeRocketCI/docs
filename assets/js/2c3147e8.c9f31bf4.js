"use strict";(self.webpackChunkkuberocketci_docs=self.webpackChunkkuberocketci_docs||[]).push([[90858],{95095:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>r,contentTitle:()=>d,default:()=>c,frontMatter:()=>l,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"user-guide/add-quality-gate","title":"Add Quality Gate","description":"This section describes how to use quality gate in KubeRocketCI and how to customize the quality gate for the CD pipeline with the selected build version of the promoted application between stages.","source":"@site/versioned_docs/version-3.9/user-guide/add-quality-gate.md","sourceDirName":"user-guide","slug":"/user-guide/add-quality-gate","permalink":"/docs/3.9/user-guide/add-quality-gate","draft":false,"unlisted":false,"editUrl":"https://github.com/KubeRocketCI/docs/edit/main/docs/user-guide/add-quality-gate.md","tags":[],"version":"3.9","lastUpdatedBy":"Sergiy Kulanov","lastUpdatedAt":1740847812000,"frontMatter":{}}');var i=n(74848),s=n(28453);const l={},d="Add Quality Gate",r={},o=[{value:"Apply New Quality Gate to Pipelines",id:"apply-new-quality-gate-to-pipelines",level:2},{value:"Run Quality Gate",id:"run-quality-gate",level:2},{value:"Add Stage for Quality Gate",id:"add-stage-for-quality-gate",level:2},{value:"Related Articles",id:"related-articles",level:2}];function p(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components},{Details:a,Head:l}=t;return a||u("Details",!0),l||u("Head",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"add-quality-gate",children:"Add Quality Gate"})}),"\n",(0,i.jsx)(l,{children:(0,i.jsx)("link",{rel:"canonical",href:"https://docs.kuberocketci.io/docs/user-guide/add-quality-gate"})}),"\n",(0,i.jsx)(t.p,{children:"This section describes how to use quality gate in KubeRocketCI and how to customize the quality gate for the CD pipeline with the selected build version of the promoted application between stages."}),"\n",(0,i.jsx)(t.h2,{id:"apply-new-quality-gate-to-pipelines",children:"Apply New Quality Gate to Pipelines"}),"\n",(0,i.jsxs)(t.p,{children:["Quality gate pipeline is a usual Tekton pipeline but with a specific label: ",(0,i.jsx)(t.code,{children:"app.edp.epam.com/pipelinetype: deploy"}),". To add and apply the quality gate to your pipelines, follow the steps below:"]}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"To use the Tekton pipeline as a quality gate pipeline, add this label to the pipelines:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:"metadata:\n  labels:\n    app.edp.epam.com/pipelinetype: deploy\n"})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"Insert the <name-of-quality-gate> value that is the quality gate name displayed in the quality gate drop-down list of the CD pipeline menu:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:"metadata:\n  name: <name-of-quality-gate>\n"})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Ensure the task ",(0,i.jsx)(t.code,{children:"promote-images"})," contains steps and logic to apply to the project. Also ensure that the last task is ",(0,i.jsx)(t.code,{children:"promote-images"})," which parameters are mandatory:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:"spec:\n  params:\n    - default: ''\n      description: Codebases with a tag separated with a space.\n      name: CODEBASE_TAG\n      type: string\n    - default: ''\n      name: CDPIPELINE_CR\n      type: string\n    - default: ''\n      name: CDPIPELINE_STAGE\n      type: string\n  tasks:\n    - name: promote-images\n      params:\n        - name: CODEBASE_TAG\n          value: $(params.CODEBASE_TAG)\n        - name: CDPIPELINE_STAGE\n          value: $(params.CDPIPELINE_STAGE)\n        - name: CDPIPELINE_CR\n          value: $(params.CDPIPELINE_CR)\n      runAfter:\n        - <last-task-name>\n      taskRef:\n        kind: Task\n        name: promote-images\n"})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Create a new pipeline with a unique name or modify your created pipeline with the command below. Please be aware that the ",(0,i.jsx)(t.code,{children:"edp"})," value is the name of the KubeRocketCI tenant:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"kubectl apply -f <file>.yaml --namespace edp\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(a,{children:[(0,i.jsx)("summary",{children:(0,i.jsx)("b",{children:"Example: Pipeline.yaml"})}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-yaml",children:"apiVersion: tekton.dev/v1beta1\nkind: Pipeline\nmetadata:\n  labels:\n    app.edp.epam.com/pipelinetype: deploy\n  name: <name-of-quality-gate>\n  namespace: edp\nspec:\n  params:\n    - default: >-\n        https://<CI-pipeline-provisioner>-edp.<cluster-name>.aws.main.edp.projects.epam.com/#/namespaces/$(context.pipelineRun.namespace)/pipelineruns/$(context.pipelineRun.name)\n      name: pipelineUrl\n      type: string\n    - default: ''\n      description: Codebases with a tag separated with a space.\n      name: CODEBASE_TAG\n      type: string\n    - default: ''\n      name: CDPIPELINE_CR\n      type: string\n    - default: ''\n      name: CDPIPELINE_STAGE\n      type: string\n  tasks:\n    - name: autotests\n      params:\n        - name: BASE_IMAGE\n          value: bitnami/kubectl:1.25.4\n        - name: EXTRA_COMMANDS\n          value: echo \"Hello World\"\n      taskRef:\n        kind: Task\n        name: run-quality-gate\n    - name: promote-images\n      params:\n        - name: CODEBASE_TAG\n          value: $(params.CODEBASE_TAG)\n        - name: CDPIPELINE_STAGE\n          value: $(params.CDPIPELINE_STAGE)\n        - name: CDPIPELINE_CR\n          value: $(params.CDPIPELINE_CR)\n      runAfter:\n        - autotests\n      taskRef:\n        kind: Task\n        name: promote-images\n"})})]}),"\n",(0,i.jsx)(t.h2,{id:"run-quality-gate",children:"Run Quality Gate"}),"\n",(0,i.jsxs)(t.p,{children:["Before running the quality gate, first of all, ensure that the environment has deployed the ",(0,i.jsx)(t.a,{href:"/docs/3.9/user-guide/add-cd-pipeline",children:"created CD pipeline"})," and then ensure that the application is successfully deployed and ready to run the quality gate. To run quality gate, please follow the steps below:"]}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Check the CD pipeline status. To do this, open the created CD pipeline, select ",(0,i.jsx)(t.code,{children:"Image stream version"}),", click ",(0,i.jsx)(t.code,{children:"DEPLOY"})," button and wait until ",(0,i.jsx)(t.code,{children:"Applications"}),", ",(0,i.jsx)(t.code,{children:"Health"})," and ",(0,i.jsx)(t.code,{children:"Sync"})," statuses become ",(0,i.jsx)(t.code,{children:"green"}),". This implies that the application is successfully deployed and ready to run the quality gate."]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"CD pipeline stage overview",src:n(26092).A+"",title:"CD pipeline stage overview",width:"1913",height:"961"})}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["Select the name-of-quality-gate of ",(0,i.jsx)(t.code,{children:"Quality gates"})," from the drop-down list and click the ",(0,i.jsx)(t.code,{children:"RUN"})," button.",(0,i.jsx)("br",{}),"The execution process should be started in the ",(0,i.jsx)(t.code,{children:"Pipelines"})," menu:"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Quality gate pipeline status",src:n(50644).A+"",title:"Quality gate pipeline status",width:"1906",height:"961"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"add-stage-for-quality-gate",children:"Add Stage for Quality Gate"}),"\n",(0,i.jsxs)(t.p,{children:["For a better understanding of this section, please read the documentation about how to ",(0,i.jsx)(t.a,{href:"/docs/3.9/user-guide/add-cd-pipeline",children:"add a new stage for quality gate"}),". The scheme below illustrates two approaches of adding quality gates:"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsx)(t.img,{alt:"Quality gate promote a scheme",src:n(68567).A+"",title:"Types of adding quality gate",width:"882",height:"513"})}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsx)(t.p,{children:"The first type of adding a quality gate is about adding the specific quality gate to the specific pipeline stage."}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["The second type is rather optional and implies activating the ",(0,i.jsx)(t.code,{children:"Promote in pipelines"})," option while creating a CD Pipeline to pass the quality gate in a certain sequence."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"As a result, after the quality gate is successfully passed, the projected image is promoted to the next stage."}),"\n",(0,i.jsx)(t.h2,{id:"related-articles",children:"Related Articles"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"/docs/3.9/user-guide/manage-environments",children:"Manage Environments"})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.a,{href:"/docs/3.9/user-guide/add-cd-pipeline",children:"Add CD Pipeline"})}),"\n"]})]})}function c(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}function u(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},26092:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/qg_cd_status-c61474d008784786d8e9ff7e3798ce70.png"},68567:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/qg_promote_shema-ba3f5b726f8a552b0dbf209dd641d47f.png"},50644:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/images/qg_stage_status-837864f3bc6c170d947c378fd73f6912.png"},28453:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>d});var a=n(96540);const i={},s=a.createContext(i);function l(e){const t=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),a.createElement(s.Provider,{value:t},e.children)}}}]);