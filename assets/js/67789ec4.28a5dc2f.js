"use strict";(self.webpackChunkkuberocketci_docs=self.webpackChunkkuberocketci_docs||[]).push([[88956],{28453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>i});var o=r(96540);const s={},t=o.createContext(s);function a(e){const n=o.useContext(t);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),o.createElement(t.Provider,{value:n},e.children)}},40559:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>a,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"operator-guide/disaster-recovery/install-velero-add-ons","title":"Install Velero","description":"Learn how to install Velero for Kubernetes backup, recovery, and migration, covering installation steps, AWS plugin configuration, and basic commands for backup and restore.","source":"@site/versioned_docs/version-3.11/operator-guide/disaster-recovery/install-velero-add-ons.md","sourceDirName":"operator-guide/disaster-recovery","slug":"/operator-guide/disaster-recovery/install-velero-add-ons","permalink":"/docs/3.11/operator-guide/disaster-recovery/install-velero-add-ons","draft":false,"unlisted":false,"editUrl":"https://github.com/KubeRocketCI/docs/edit/main/docs/operator-guide/disaster-recovery/install-velero-add-ons.md","tags":[],"version":"3.11","lastUpdatedBy":"Kostiantyn Krykun","lastUpdatedAt":1765438428000,"frontMatter":{"title":"Install Velero","description":"Learn how to install Velero for Kubernetes backup, recovery, and migration, covering installation steps, AWS plugin configuration, and basic commands for backup and restore.","sidebar_label":"Install Velero"},"sidebar":"operatorGuideSidebar","previous":{"title":"Use Cert-Manager in OpenShift","permalink":"/docs/3.11/operator-guide/infrastructure-providers/okd/ssl-automation-okd"},"next":{"title":"Restore KubeRocketCI Tenant With Velero","permalink":"/docs/3.11/operator-guide/disaster-recovery/velero-restore-platform"}}');var s=r(74848),t=r(28453);const a={title:"Install Velero",description:"Learn how to install Velero for Kubernetes backup, recovery, and migration, covering installation steps, AWS plugin configuration, and basic commands for backup and restore.",sidebar_label:"Install Velero"},i="Automated Kubernetes Backup and Restore Workflows With Velero",l={},c=[{value:"Configuring AWS IAM Roles and Policies",id:"configuring-aws-iam-roles-and-policies",level:2},{value:"Install Velero",id:"install-velero",level:2},{value:"Related Articles",id:"related-articles",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components},{Head:r}=n;return r||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Head",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"automated-kubernetes-backup-and-restore-workflows-with-velero",children:"Automated Kubernetes Backup and Restore Workflows With Velero"})}),"\n",(0,s.jsx)(r,{children:(0,s.jsx)("link",{rel:"canonical",href:"https://docs.kuberocketci.io/docs/operator-guide/disaster-recovery/install-velero-add-ons"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://velero.io/",children:"Velero"})," is an open source tool to safely back up, recover, and migrate Kubernetes clusters and persistent volumes.\nIt works both on premises and in a public cloud. Velero consists of a server process running as a deployment in your\nKubernetes cluster and a command-line interface (CLI) with which DevOps teams and platform operators configure scheduled\nbackups, trigger ad-hoc backups, perform restores, and more."]}),"\n",(0,s.jsx)(n.p,{children:"Configuring and installing Velero involves two key steps:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Setting up AWS resources"})," \u2013 configuring IAM roles and policies."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Installing Velero"})," \u2013 deploying the Velero components into the Kubernetes cluster."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"configuring-aws-iam-roles-and-policies",children:"Configuring AWS IAM Roles and Policies"}),"\n",(0,s.jsx)(n.p,{children:"Velero requires specific IAM permissions to interact with AWS resources. These permissions allow Velero to create and manage EBS snapshots and volumes, as well as read and write backup data to the designated S3 bucket. This policy ensures Velero can perform backup and restore operations within your AWS account."}),"\n",(0,s.jsxs)(n.p,{children:["To simplify the setup, we recommend using the ",(0,s.jsx)(n.a,{href:"https://registry.terraform.io/modules/terraform-module/velero/kubernetes/latest",children:"terraform-module/velero/kubernetes"})," module. This module automates the creation of the necessary IAM roles and policies for Velero. You can find Velero configuration parameters in the ",(0,s.jsx)(n.a,{href:"https://github.com/KubeRocketCI/terraform-aws-platform/blob/master/eks/irsa.tf#L367",children:"terraform-aws-platform"})," repository."]}),"\n",(0,s.jsx)(n.p,{children:"With this configuration, the following IAM role will be created:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"AWSIRSA_<ClusterName>_Velero"}),": This role will be used by Velero to perform backup and restore operations by managing EBS snapshots and accessing the S3 backup bucket. The attached policy grants Velero the required permissions to perform backup and restore operations in AWS. It includes the following capabilities:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"EC2 permissions"})," \u2014 allow Velero to create, describe, tag, and delete EBS snapshots and volumes used during backup and restore processes."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"S3 bucket access"})," \u2014 allows listing the backup bucket and performing read/write operations on objects, including uploading backup data, retrieving it during restores, and deleting or tagging objects as needed."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"install-velero",children:"Install Velero"}),"\n",(0,s.jsxs)(n.p,{children:["To deploy Velero in your Kubernetes cluster, we recommend using the ",(0,s.jsx)(n.a,{href:"https://github.com/epam/edp-cluster-add-ons/tree/main/clusters/core/addons/velero",children:"add-ons approach"}),". Here's an example of how to configure values.yaml before installation:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="values.yaml"',children:'velero:\n  # -- Velero service account settings for AWS access via IRSA. Replace the role ARN with your own IAM role.\n  serviceAccount:\n    server:\n      create: true\n      name: velero-server\n      annotations:\n        eks.amazonaws.com/role-arn: "arn:aws:iam::01234567890:role/AWSIRSA_Core_Velero"\n\n  # -- Use Kubernetes secrets for AWS credentials (false = use IRSA)\n  credentials:\n    useSecret: false\n\n  configuration:\n    # -- Backup storage settings for Velero\n    backupStorageLocation:\n    - name: default\n      provider: aws\n      bucket: velero-core\n      prefix: velero\n      config:\n        region: eu-central-1\n    # -- Settings for volume snapshots\n    volumeSnapshotLocation:\n    - name: default\n      provider: aws\n      config:\n        region: eu-central-1\n\n  # -- Init container to load AWS plugin for Velero\n  initContainers:\n    - name: velero-plugin-for-aws\n      image: velero/velero-plugin-for-aws:v1.13.1\n      volumeMounts:\n        - mountPath: /target\n          name: plugins\n\n  # --------------------------------------------\n  # Velero Schedule: krci\n  # --------------------------------------------\n  # Description:\n  #   Creates daily backups of the "krci" namespace\n  #   on weekdays (Monday\u2013Friday) at 13:00 UTC.\n  #   Excludes PersistentVolumes and PVCs,\n  #   does not snapshot volumes,\n  #   stores backups in the "default" location,\n  #   and retains them for 72 hours.\n  # --------------------------------------------\n  schedules:\n    krci:\n      disabled: true\n      paused: false\n      labels:\n        cluster: core\n        region: eu-central-1\n      schedule: "0 13 * * 1-5"\n      useOwnerReferencesInBackup: false\n      template:\n        excludedClusterScopedResources:\n          - persistentvolumes\n        excludedNamespaceScopedResources:\n          - persistentvolumeclaims\n        includedNamespaces:\n          - krci\n        snapshotVolumes: false\n        storageLocation: default\n        ttl: 72h0m0s\n'})}),"\n",(0,s.jsx)(n.p,{children:"At the end of the file, you will find backup schedule settings that you can use as a template for creating your own schedules."}),"\n",(0,s.jsx)(n.h2,{id:"related-articles",children:"Related Articles"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/3.11/operator-guide/infrastructure-providers/aws/enable-irsa",children:"Associate IAM Roles With Service Accounts"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);