"use strict";(self.webpackChunkkuberocketci_docs=self.webpackChunkkuberocketci_docs||[]).push([[26535],{21804:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"operator-guide/auth/ui-portal-oidc","title":"Portal OIDC Configuration","description":"Configure OIDC authorization for the KubeRocketCI Portal UI with Keycloak, enabling Single Sign-On for streamlined access management.","source":"@site/versioned_docs/version-3.9/operator-guide/auth/ui-portal-oidc.md","sourceDirName":"operator-guide/auth","slug":"/operator-guide/auth/ui-portal-oidc","permalink":"/docs/3.9/operator-guide/auth/ui-portal-oidc","draft":false,"unlisted":false,"editUrl":"https://github.com/KubeRocketCI/docs/edit/main/docs/operator-guide/auth/ui-portal-oidc.md","tags":[],"version":"3.9","lastUpdatedBy":"Sergiy Kulanov","lastUpdatedAt":1740847812000,"frontMatter":{"title":"Portal OIDC Configuration","description":"Configure OIDC authorization for the KubeRocketCI Portal UI with Keycloak, enabling Single Sign-On for streamlined access management.","sidebar_label":"Portal OIDC Configuration"},"sidebar":"operatorGuideSidebar","previous":{"title":"Install Keycloak","permalink":"/docs/3.9/operator-guide/auth/keycloak"},"next":{"title":"EKS OIDC With Keycloak","permalink":"/docs/3.9/operator-guide/auth/configure-keycloak-oidc-eks"}}');var o=i(74848),r=i(28453);const a={title:"Portal OIDC Configuration",description:"Configure OIDC authorization for the KubeRocketCI Portal UI with Keycloak, enabling Single Sign-On for streamlined access management.",sidebar_label:"Portal OIDC Configuration"},s="Portal OIDC Configuration",l={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Configure Keycloak",id:"configure-keycloak",level:2},{value:"Integrate Portal With Kubernetes",id:"integrate-portal-with-kubernetes",level:2},{value:"Changing the Lifespan of an Access Token",id:"changing-the-lifespan-of-an-access-token",level:2},{value:"Related Articles",id:"related-articles",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components},{Head:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Head",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"portal-oidc-configuration",children:"Portal OIDC Configuration"})}),"\n",(0,o.jsx)(t,{children:(0,o.jsx)("link",{rel:"canonical",href:"https://docs.kuberocketci.io/docs/operator-guide/auth/ui-portal-oidc"})}),"\n",(0,o.jsxs)(n.p,{children:["This page provides instructions for configuring the ",(0,o.jsx)(n.a,{href:"https://openid.net/connect/",children:"OIDC authorization"})," for the KubeRocketCI ",(0,o.jsx)(n.a,{href:"/docs/3.9/user-guide/",children:"Portal UI"}),", enabling the use of Single Sign-On (SSO) for authorization in the Portal. This configuration allows for centralized control of user access and rights from a single configuration point."]}),"\n",(0,o.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,o.jsx)(n.p,{children:"Ensure the following values are set first before starting the Portal OIDC configuration:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"realm_id"}),"  = ",(0,o.jsx)(n.strong,{children:"shared"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"client_id"})," = ",(0,o.jsx)(n.strong,{children:"eks"})]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"keycloak_client_key"}),"= ",(0,o.jsx)(n.strong,{children:"keycloak_client_secret_key"})," (received from: ",(0,o.jsx)(n.code,{children:"Shared realm"})," -> ",(0,o.jsx)(n.code,{children:"clients"})," -> ",(0,o.jsx)(n.code,{children:"eks"})," -> ",(0,o.jsx)(n.code,{children:"Credentials"})," -> ",(0,o.jsx)(n.code,{children:"Client secret"}),")"]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["The values indicated above are the result of the Keycloak configuration as an OIDC identity provider.\nTo obtain these values, please refer to the guidelines on the ",(0,o.jsx)(n.a,{href:"/docs/3.9/operator-guide/auth/configure-keycloak-oidc-eks",children:"Keycloak OIDC EKS Configuration"})," page."]})}),"\n",(0,o.jsx)(n.h2,{id:"configure-keycloak",children:"Configure Keycloak"}),"\n",(0,o.jsx)(n.p,{children:"To proceed with the Keycloak configuration, perform the following:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Add the URL of the Headlamp to the ",(0,o.jsx)(n.code,{children:"valid_redirect_uris"})," variable in ",(0,o.jsx)(n.a,{href:"https://github.com/epam/edp-cluster-add-ons/blob/main/clusters/core/addons/kuberocketci-rbac/templates/kubernetes/keycloak-client.yaml#L17",children:"Keycloak"}),":"]}),"\n",(0,o.jsx)(n.admonition,{title:"keycloak_openid_client",type:"note",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'  redirectUris:\n    - "https://portal.<dns_wildcard>/*"\n    - "http://localhost:8000/*"\n'})})}),"\n",(0,o.jsx)(n.p,{children:"Make sure to define the following Keycloak client values as indicated:"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"Keycloak client configuration",src:i(7261).A+"",title:"Keycloak client configuration",width:"567",height:"758"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Configure the Keycloak client key in Kubernetes using the Kubernetes secrets or the ",(0,o.jsx)(n.a,{href:"/docs/3.9/operator-guide/secrets-management/external-secrets-operator-integration",children:"External Secrets Operator"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Secret\nmetadata:\n  name: keycloak-client-headlamp-secret\n  namespace: edp\ntype: Opaque\nstringData:\n  clientSecret: <keycloak_client_secret_key>\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Assign user to one or more groups in Keycloak."}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"integrate-portal-with-kubernetes",children:"Integrate Portal With Kubernetes"}),"\n",(0,o.jsx)(n.p,{children:"Portal is integrated in Kubernetes in three steps:"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Update the ",(0,o.jsx)(n.a,{href:"/docs/3.9/operator-guide/install-kuberocketci",children:"values.yaml"})," file by enabling OIDC:"]}),"\n",(0,o.jsx)(n.admonition,{title:"values.yaml",type:"note",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"edp-headlamp:\n  config:\n    oidc:\n      enabled: true\n"})})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Navigate to Portal UI and log in by clicking the ",(0,o.jsx)(n.code,{children:"Sign In"})," button:"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"Portal login page",src:i(77557).A+"",title:"Portal login page",width:"986",height:"752"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Upon logging in, specify the namespace for KubeRocketCI where platform is deployed by clicking the cluster settings link in the bottom left corner of the UI:"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"Portal namespace settings",src:i(97881).A+"",title:"Portal namespace settings",width:"3486",height:"2072"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"As a result, it is possible to control access and rights from the Keycloak endpoint."}),"\n",(0,o.jsx)(n.h2,{id:"changing-the-lifespan-of-an-access-token",children:"Changing the Lifespan of an Access Token"}),"\n",(0,o.jsxs)(n.p,{children:["Change the Access Token Lifespan: go to your Keycloak and select ",(0,o.jsx)(n.em,{children:"Openshift realm"})," > ",(0,o.jsx)(n.em,{children:"Realm settings"})," > ",(0,o.jsx)(n.em,{children:"Tokens"})," >\n",(0,o.jsx)(n.em,{children:"Access Token Lifespan"})," > set a new value to the field and save this change."]}),"\n",(0,o.jsx)(n.p,{children:'By default, "Access Token Lifespan" value is 5 minutes.'}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{alt:"Access Token Lifespan",src:i(84069).A+"",title:"Access Token Lifespan",width:"3102",height:"1330"})}),"\n",(0,o.jsx)(n.h2,{id:"related-articles",children:"Related Articles"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/docs/3.9/operator-guide/auth/configure-keycloak-oidc-eks",children:"EKS OIDC With Keycloak"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/docs/3.9/operator-guide/secrets-management/external-secrets-operator-integration",children:"External Secrets Operator"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},84069:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/keycloak-access-token-lifespan-ffd35af51d3b872ea007abace8129f66.png"},97881:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/edp_portal_ui-95bcdfc9fd6ae7e8d299b16029b7b16e.png"},77557:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/headlamp-oidc-headlamp-1-e967452206d74b2ee46dea95f5dd2dac.png"},7261:(e,n,i)=>{i.d(n,{A:()=>t});const t=i.p+"assets/images/headlamp-oidc-keycloak-2-bafd11c950da74e7a467d9237538077b.png"},28453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>s});var t=i(96540);const o={},r=t.createContext(o);function a(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);