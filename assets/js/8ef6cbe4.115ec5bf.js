"use strict";(self.webpackChunkkuberocketci_docs=self.webpackChunkkuberocketci_docs||[]).push([[40134],{15819:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"operator-guide/cd/customize-environment-deletion","title":"Customize Environment Cleanup","description":"Guidelines on creating custom clean pipelines in KubeRocketCI for tailored environment cleanup procedures, enhancing resource management during deletion.","source":"@site/docs/operator-guide/cd/customize-environment-deletion.md","sourceDirName":"operator-guide/cd","slug":"/operator-guide/cd/customize-environment-deletion","permalink":"/docs/next/operator-guide/cd/customize-environment-deletion","draft":false,"unlisted":false,"editUrl":"https://github.com/KubeRocketCI/docs/edit/main/docs/operator-guide/cd/customize-environment-deletion.md","tags":[],"version":"current","lastUpdatedBy":"Sergiy Kulanov","lastUpdatedAt":1740847812000,"frontMatter":{"title":"Customize Environment Cleanup","description":"Guidelines on creating custom clean pipelines in KubeRocketCI for tailored environment cleanup procedures, enhancing resource management during deletion.","sidebar_label":"Customize Environment Cleanup"},"sidebar":"operatorGuideSidebar","previous":{"title":"Customize Deploy Pipeline","permalink":"/docs/next/operator-guide/cd/customize-deploy-pipeline"},"next":{"title":"Manual Approval in Pipelines","permalink":"/docs/next/operator-guide/cd/manual-approval"}}');var s=t(74848),l=t(28453);const r={title:"Customize Environment Cleanup",description:"Guidelines on creating custom clean pipelines in KubeRocketCI for tailored environment cleanup procedures, enhancing resource management during deletion.",sidebar_label:"Customize Environment Cleanup"},o="Customize Environment Cleanup",a={},c=[{value:"Create Custom Clean Pipeline",id:"create-custom-clean-pipeline",level:2},{value:"Enable Clean Pipeline",id:"enable-clean-pipeline",level:2},{value:"New Environments",id:"new-environments",level:3},{value:"Existing Environments",id:"existing-environments",level:3},{value:"Related Articles",id:"related-articles",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components},{Head:i}=n;return i||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Head",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"customize-environment-cleanup",children:"Customize Environment Cleanup"})}),"\n",(0,s.jsx)(i,{children:(0,s.jsx)("link",{rel:"canonical",href:"https://docs.kuberocketci.io/docs/operator-guide/cd/customize-environment-deletion"})}),"\n",(0,s.jsx)(n.p,{children:"KubeRocketCI provides capabilities to fully operate the CI/CD flow, starting from building applications to deploying its new release. The operation flow is designed to be seamless for most of the users. However, there may be cases where more specialized actions are necessary. These might include custom procedures for managing the deletion of application resources."}),"\n",(0,s.jsx)(n.h2,{id:"create-custom-clean-pipeline",children:"Create Custom Clean Pipeline"}),"\n",(0,s.jsx)(n.p,{children:"Delete pipeline is a typical Tekton pipeline but with its own instructions. The custom delete pipeline creation involves the following steps:"}),"\n",(0,s.jsx)(n.mermaid,{value:"graph LR;\n    A(Create TriggerTemplate resource) --\x3e B(Create Pipeline resource) --\x3e C(Create Task resource) --\x3e D(Apply changes to environment)"}),"\n",(0,s.jsxs)(n.p,{children:["Clean pipeline consists of ",(0,s.jsx)(n.strong,{children:"Trigger Template"}),", ",(0,s.jsx)(n.strong,{children:"Pipeline"}),", and ",(0,s.jsx)(n.strong,{children:"Task"})," custom resources. To create a custom clean pipeline, follow the steps below:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Create and apply the ",(0,s.jsx)(n.strong,{children:"TriggerTemplate"})," custom resource. Refer to the example ",(0,s.jsx)(n.a,{href:"https://github.com/epam/edp-tekton/blob/master/charts/pipelines-library/templates/triggers/cd/clean.yaml",children:"TriggerTemplate"}),". Ensure to set the appropriate pipeline type in the labels:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"...\nlabels:\n    app.edp.epam.com/pipelinetype: clean\n...\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"...\nspec:\n  taskRunTemplate:\n    serviceAccountName: tekton\n  pipelineRef:\n    name: clean-custom\n...\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsxs)(n.li,{children:["Create and apply the ",(0,s.jsx)(n.strong,{children:"Pipeline"})," custom resource. Refer to the example ",(0,s.jsx)(n.a,{href:"https://github.com/epam/edp-tekton/blob/master/charts/pipelines-library/templates/pipelines/cd/clean.yaml",children:"Pipeline"}),". Ensure to set the concrete task to trigger:"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Additionally, set the concrete task to run:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"tasks:\n  - name: clean\n    taskRef:\n      kind: Task\n      name: clean-custom\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsxs)(n.li,{children:["Create and apply the ",(0,s.jsx)(n.strong,{children:"Task"})," custom resource. Refer to the example ",(0,s.jsx)(n.a,{href:"https://github.com/epam/edp-tekton/blob/master/charts/pipelines-library/templates/tasks/cd/clean.yaml",children:"Task"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"enable-clean-pipeline",children:"Enable Clean Pipeline"}),"\n",(0,s.jsx)(n.p,{children:"As soon as all the three custom resources are correctly configured and applied, you can select the newly created pipeline in the KubeRocketCI portal."}),"\n",(0,s.jsx)(n.h3,{id:"new-environments",children:"New Environments"}),"\n",(0,s.jsx)(n.p,{children:"To apply the newly created clean pipeline to your environments, follow the steps below:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["In the deployment flow details page, click the ",(0,s.jsx)(n.strong,{children:"Create environment"})," button:"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Create environment button&quot;",src:t(10055).A+"",title:"Create environment button",width:"1915",height:"1112"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsxs)(n.li,{children:["In the ",(0,s.jsx)(n.strong,{children:"Create environment"})," window, select the custom clean pipeline:"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Select custom clean pipeline",src:t(75261).A+"",title:"Select custom clean pipeline",width:"1915",height:"1112"})}),"\n",(0,s.jsx)(n.h3,{id:"existing-environments",children:"Existing Environments"}),"\n",(0,s.jsx)(n.p,{children:"If you need to change the delete pipeline in an already existing environment, follow the steps below:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Navigate to the environment details page and click the ",(0,s.jsx)(n.strong,{children:"Edit"})," button:"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Edit environment button",src:t(71795).A+"",title:"Edit environment button",width:"1916",height:"1111"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsxs)(n.li,{children:["In the ",(0,s.jsx)(n.strong,{children:"Edit environment"})," window, select the custom clean pipeline:"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Select custom clean pipeline",src:t(34022).A+"",title:"Select custom clean pipeline",width:"1915",height:"1112"})}),"\n",(0,s.jsxs)(n.p,{children:["As soon as the clean pipeline is created and selected within an environment, you can trigger it by clicking the ",(0,s.jsx)(n.strong,{children:"Clean"})," button."]}),"\n",(0,s.jsx)(n.h2,{id:"related-articles",children:"Related Articles"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/next/operator-guide/cd/customize-deploy-pipeline",children:"Customize Deploy Pipeline"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/next/user-guide/add-cd-pipeline",children:"Add Deployment Flow"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/next/user-guide/manage-environments",children:"Manage Deployment Flows"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},10055:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/create-environment-button-d6c54eefc7d10ab7f6bc1f0aaf538642.png"},75261:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/custom-clean-pipeline1-0f26702ade3a8012281144c4b525d8e9.png"},34022:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/custom-clean-pipeline2-85130bc760259afc13dd6889171ee1f2.png"},71795:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/edit-environment-button-9f24e89732963a309c5560a00c16931a.png"},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>o});var i=t(96540);const s={},l=i.createContext(s);function r(e){const n=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);