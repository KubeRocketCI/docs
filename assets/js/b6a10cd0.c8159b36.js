"use strict";(self.webpackChunkkuberocketci_docs=self.webpackChunkkuberocketci_docs||[]).push([[17718],{3483:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/gitfusion-fc54f5b503f2247b74c43543907cf271.png"},11470:(e,n,t)=>{t.d(n,{A:()=>_});var a=t(96540),i=t(34164),s=t(17559),r=t(23104),o=t(56347),c=t(205),l=t(57485),d=t(31682),p=t(70679);function u(e){return a.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function h(e){const{values:n,children:t}=e;return(0,a.useMemo)(()=>{const e=n??function(e){return u(e).map(({props:{value:e,label:n,attributes:t,default:a}})=>({value:e,label:n,attributes:t,default:a}))}(t);return function(e){const n=(0,d.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,t])}function m({value:e,tabValues:n}){return n.some(n=>n.value===e)}function g({queryString:e=!1,groupId:n}){const t=(0,o.W6)(),i=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,l.aZ)(i),(0,a.useCallback)(e=>{if(!i)return;const n=new URLSearchParams(t.location.search);n.set(i,e),t.replace({...t.location,search:n.toString()})},[i,t])]}function b(e){const{defaultValue:n,queryString:t=!1,groupId:i}=e,s=h(e),[r,o]=(0,a.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!m({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find(e=>e.default)??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:s})),[l,d]=g({queryString:t,groupId:i}),[u,b]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,i]=(0,p.Dv)(n);return[t,(0,a.useCallback)(e=>{n&&i.set(e)},[n,i])]}({groupId:i}),j=(()=>{const e=l??u;return m({value:e,tabValues:s})?e:null})();(0,c.A)(()=>{j&&o(j)},[j]);return{selectedValue:r,selectValue:(0,a.useCallback)(e=>{if(!m({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);o(e),d(e),b(e)},[d,b,s]),tabValues:s}}var j=t(92303);const x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var k=t(74848);function f({className:e,block:n,selectedValue:t,selectValue:a,tabValues:s}){const o=[],{blockElementScrollPositionUntilNextRender:c}=(0,r.a_)(),l=e=>{const n=e.currentTarget,i=o.indexOf(n),r=s[i].value;r!==t&&(c(n),a(r))},d=e=>{let n=null;switch(e.key){case"Enter":l(e);break;case"ArrowRight":{const t=o.indexOf(e.currentTarget)+1;n=o[t]??o[0];break}case"ArrowLeft":{const t=o.indexOf(e.currentTarget)-1;n=o[t]??o[o.length-1];break}}n?.focus()};return(0,k.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,i.A)("tabs",{"tabs--block":n},e),children:s.map(({value:e,label:n,attributes:a})=>(0,k.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{o.push(e)},onKeyDown:d,onClick:l,...a,className:(0,i.A)("tabs__item",x.tabItem,a?.className,{"tabs__item--active":t===e}),children:n??e},e))})}function v({lazy:e,children:n,selectedValue:t}){const s=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=s.find(e=>e.props.value===t);return e?(0,a.cloneElement)(e,{className:(0,i.A)("margin-top--md",e.props.className)}):null}return(0,k.jsx)("div",{className:"margin-top--md",children:s.map((e,n)=>(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==t}))})}function y(e){const n=b(e);return(0,k.jsxs)("div",{className:(0,i.A)(s.G.tabs.container,"tabs-container",x.tabList),children:[(0,k.jsx)(f,{...n,...e}),(0,k.jsx)(v,{...n,...e})]})}function _(e){const n=(0,j.A)();return(0,k.jsx)(y,{...e,children:u(e.children)},String(n))}},16509:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/remote-clusters-08283e0b0f6207a5112f39d436d1ab47.png"},19365:(e,n,t)=>{t.d(n,{A:()=>r});t(96540);var a=t(34164);const i={tabItem:"tabItem_Ymn6"};var s=t(74848);function r({children:e,hidden:n,className:t}){return(0,s.jsx)("div",{role:"tabpanel",className:(0,a.A)(i.tabItem,t),hidden:n,children:e})}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>o});var a=t(96540);const i={},s=a.createContext(i);function r(e){const n=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),a.createElement(s.Provider,{value:n},e.children)}},37635:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/delete-cluster-85b1b2f63512868c5b7639a91f8d595e.png"},88600:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>a,toc:()=>p});const a=JSON.parse('{"id":"operator-guide/upgrade/upgrade-krci-3.12","title":"Upgrade KubeRocketCI v3.11 to 3.12","description":"Guide on upgrading KubeRocketCI to version 3.12. Includes steps for updating Tekton custom pipelines and enabling GitFusion integration.","source":"@site/versioned_docs/version-3.10/operator-guide/upgrade/upgrade-krci-3.12.md","sourceDirName":"operator-guide/upgrade","slug":"/operator-guide/upgrade/upgrade-krci-3.12","permalink":"/docs/3.10/operator-guide/upgrade/upgrade-krci-3.12","draft":false,"unlisted":false,"editUrl":"https://github.com/KubeRocketCI/docs/edit/main/docs/operator-guide/upgrade/upgrade-krci-3.12.md","tags":[],"version":"3.10","lastUpdatedBy":"Daniil Nedostup","lastUpdatedAt":1758531870000,"frontMatter":{"title":"Upgrade KubeRocketCI v3.11 to 3.12","description":"Guide on upgrading KubeRocketCI to version 3.12. Includes steps for updating Tekton custom pipelines and enabling GitFusion integration.","sidebar_label":"v3.11 to 3.12"},"sidebar":"operatorGuideSidebar","previous":{"title":"Restore KubeRocketCI Tenant With Velero","permalink":"/docs/3.10/operator-guide/disaster-recovery/velero-restore-platform"},"next":{"title":"v3.10 to 3.11","permalink":"/docs/3.10/operator-guide/upgrade/upgrade-edp-3.11"}}');var i=t(74848),s=t(28453),r=t(11470),o=t(19365);const c={title:"Upgrade KubeRocketCI v3.11 to 3.12",description:"Guide on upgrading KubeRocketCI to version 3.12. Includes steps for updating Tekton custom pipelines and enabling GitFusion integration.",sidebar_label:"v3.11 to 3.12"},l="Upgrade KubeRocketCI v3.11 to 3.12",d={},p=[];function u(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components},{Details:a,Head:c}=n;return a||m("Details",!0),c||m("Head",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"upgrade-kuberocketci-v311-to-312",children:"Upgrade KubeRocketCI v3.11 to 3.12"})}),"\n",(0,i.jsx)(c,{children:(0,i.jsx)("link",{rel:"canonical",href:"https://docs.kuberocketci.io/docs/operator-guide/upgrade/upgrade-krci-3.12"})}),"\n",(0,i.jsx)(n.p,{children:"This section provides detailed instructions for upgrading KubeRocketCI to version 3.12. Follow the steps and requirements outlined below:"}),"\n",(0,i.jsx)(n.admonition,{type:"important",children:(0,i.jsx)(n.p,{children:"We suggest backing up the KubeRocketCI environment before starting the upgrade procedure."})}),"\n",(0,i.jsx)(n.admonition,{type:"important",children:(0,i.jsxs)(n.p,{children:["In version 3.12, the ",(0,i.jsx)(n.code,{children:"docker.io/epamedp/tekton-cache"})," image has been ",(0,i.jsx)(n.a,{href:"https://github.com/epam/edp-tekton/issues/511",children:"deprecated"})," and replaced with ",(0,i.jsx)(n.code,{children:"ghcr.io/kuberocketci/krci-cache"}),". In case of using the ",(0,i.jsx)(n.a,{href:"https://github.com/epam/edp-tekton/tree/master/charts/tekton-cache",children:"tekton-cache"})," Helm chart, the image will be automatically updated during the upgrade process."]})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"(Optional) Update Tekton Custom Pipelines"}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["For more information about using Tekton custom pipelines in KubeRocketCI, refer to the ",(0,i.jsx)(n.a,{href:"/docs/3.10/use-cases/custom-pipelines-flow",children:"Create and Use Custom Tekton Pipelines"})," use case."]})}),"\n",(0,i.jsx)(n.p,{children:"In case of using Tekton custom pipelines, it is necessary to update them to ensure compatibility with the new version of KubeRocketCI."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Branch Name Validation Update"}),"\n",(0,i.jsxs)(n.p,{children:["Starting from version 3.12, the KubeRocketCI portal ",(0,i.jsx)(n.a,{href:"https://github.com/epam/edp-headlamp/issues/753",children:"supports"})," adding branches with long names (more than 30 characters), including support for special characters and uppercase letters. Due to this change, it is necessary to update the passing parameters for the ",(0,i.jsx)(n.code,{children:"update-cbis"})," task in the Tekton custom build pipelines to ensure compatibility with the new version of KubeRocketCI."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"update-cbis"})," Tekton task now accepts the ",(0,i.jsx)(n.code,{children:"CODEBASEBRANCH_NAME"})," parameter instead of ",(0,i.jsx)(n.code,{children:"CBIS_NAME"}),". Update the ",(0,i.jsx)(n.code,{children:"update-cbis"})," passing parameters in the Tekton custom build pipelines as follows:"]}),"\n",(0,i.jsxs)(r.A,{defaultValue:"3.11",values:[{label:"3.11",value:"3.11"},{label:"3.12",value:"3.12"}],children:[(0,i.jsx)(o.A,{value:"3.11",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="Pipeline"',children:"apiVersion: tekton.dev/v1\nkind: Pipeline\nmetadata:\n  labels:\n    app.edp.epam.com/pipelinetype: build\n    app.edp.epam.com/triggertemplate: github-build-template\n  name: custom-build-pipeline\nspec:\n  ...\n  tasks:\n    - name: update-cbis\n      params:\n        - name: CBIS_NAME\n          value: $(tasks.init-values.results.RESULT_IMAGE_NAME)\n        - name: IMAGE_TAG\n          value: $(tasks.get-version.results.IS_TAG)\n      runAfter:\n        - git-tag\n      taskRef:\n        kind: Task\n        name: update-cbis\n"})})}),(0,i.jsx)(o.A,{value:"3.12",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="Pipeline"',children:"apiVersion: tekton.dev/v1\nkind: Pipeline\nmetadata:\n  labels:\n    app.edp.epam.com/pipelinetype: build\n    app.edp.epam.com/triggertemplate: github-build-template\n  name: custom-build-pipeline\nspec:\n  ...\n  tasks:\n    - name: update-cbis\n      params:\n        - name: CODEBASEBRANCH_NAME\n          value: $(params.CODEBASEBRANCH_NAME)\n        - name: IMAGE_TAG\n          value: $(tasks.get-version.results.IS_TAG)\n      runAfter:\n        - git-tag\n      taskRef:\n        kind: Task\n        name: update-cbis\n"})})})]}),"\n",(0,i.jsxs)(n.p,{children:["Updated ",(0,i.jsx)(n.code,{children:"update-cbis"})," task in the KubeRocketCI version 3.12 is provided below for reference:"]}),"\n",(0,i.jsxs)(a,{children:[(0,i.jsx)("summary",{children:(0,i.jsx)("b",{children:"update-cbis"})}),(0,i.jsxs)(n.p,{children:["Updated ",(0,i.jsx)(n.code,{children:"update-cbis"})," task in KubeRocketCI version 3.12:"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'apiVersion: tekton.dev/v1\nkind: Task\nmetadata:\n  name: update-cbis\nspec:\n  description: >-\n    This task updates a Codebase ImageStream (CBIS) with a new image tag. It checks for the presence of tags in the specified CBIS and adds the new tag if it doesn\'t already exist.\n    The task utilizes kubectl commands and is customizable with parameters for CBIS\n  params:\n    - name: CODEBASEBRANCH_NAME\n      type: string\n      description: "CodebaseBranch name with only letters and dashes"\n    - name: IMAGE_TAG\n      type: string\n    - name: BASE_IMAGE\n      description: The base image for the task.\n      type: string\n      default: {{ include "edp-tekton.registry" . }}/bitnami/kubectl:1.25.4\n  steps:\n    - name: update-cbis\n      image: $(params.BASE_IMAGE)\n      env:\n        - name: CODEBASEBRANCH_NAME\n          value: "$(params.CODEBASEBRANCH_NAME)"\n        - name: IMAGE_TAG\n          value: "$(params.IMAGE_TAG)"\n      script: |\n        #!/usr/bin/env bash\n        set -e\n\n        cbisName=$(kubectl get cbis.v2.edp.epam.com -l app.edp.epam.com/codebasebranch="${CODEBASEBRANCH_NAME}" -o jsonpath=\'{.items[0].metadata.name}\')\n        if [ -z "${cbisName}" ]; then\n            echo "[TEKTON][ERROR] No CBIS found with label app.edp.epam.com/codebasebranch=${CODEBASEBRANCH_NAME}"\n            exit 1\n        fi\n\n        cbisCrTags=$(kubectl get cbis.v2.edp.epam.com ${cbisName} --output=jsonpath={.spec.tags})\n        dateFormat=$(date -u \'+%Y-%m-%dT%H:%M:%SZ\')\n        newcbisTag="{\\"name\\":\\"${IMAGE_TAG}\\",\\"created\\":\\"${dateFormat}\\"}"\n\n        if [ "${cbisCrTags}" = "" ] ; then\n            echo "[TEKTON][DEBUG] There\'re no tags in imageStream ${cbisName} ... the first one will be added."\n            kubectl patch cbis.v2.edp.epam.com ${cbisName} --type=merge -p "{\\"spec\\":{\\"tags\\":[${newcbisTag}]}}"\n        fi\n\n        cbisTagsList=$(kubectl get cbis.v2.edp.epam.com ${cbisName} --output=jsonpath={.spec.tags[*].name})\n        if [[ ! ${cbisTagsList} == *"${IMAGE_TAG}"* ]]; then\n            echo "[TEKTON][DEBUG] ImageStream ${cbisName} doesn\'t contain ${IMAGE_TAG} tag ... it will be added."\n            kubectl patch cbis.v2.edp.epam.com ${cbisName} --type json -p="[{\\"op\\": \\"add\\", \\"path\\": \\"/spec/tags/-\\", \\"value\\": ${newcbisTag} }]"\n        fi\n'})})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Build Pipeline Task Condition Update"}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["This change is relevant only for build pipelines with ",(0,i.jsx)(n.code,{children:"semver"})," versioning type."]})}),"\n",(0,i.jsxs)(n.p,{children:["In version 3.12, the execution condition for the ",(0,i.jsx)(n.code,{children:"update-cbb"})," Tekton task has been ",(0,i.jsx)(n.a,{href:"https://github.com/epam/edp-tekton/issues/509",children:"updated"})," to ensure that the ",(0,i.jsx)(n.code,{children:"Successful build"})," field for the Component branch is properly updated in the KubeRocketCI portal. Now, the ",(0,i.jsx)(n.code,{children:"update-cbb"})," task will also be executed if build pipelines are triggered manually and have the ",(0,i.jsx)(n.code,{children:"Completed"})," status."]}),"\n",(0,i.jsxs)(n.p,{children:["Update the ",(0,i.jsx)(n.code,{children:"update-cbb"})," task condition in the Tekton custom build pipelines as follows:"]}),"\n",(0,i.jsxs)(r.A,{defaultValue:"3.11",values:[{label:"3.11",value:"3.11"},{label:"3.12",value:"3.12"}],children:[(0,i.jsx)(o.A,{value:"3.11",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="Pipeline"',children:"apiVersion: tekton.dev/v1\nkind: Pipeline\nmetadata:\n  labels:\n    app.edp.epam.com/pipelinetype: build\n    app.edp.epam.com/triggertemplate: github-build-template\n  name: custom-build-semver\nspec:\n  ...\n  finally:\n    - name: update-cbb\n      params:\n        - name: CODEBASEBRANCH_NAME\n          value: $(params.CODEBASEBRANCH_NAME)\n        - name: CURRENT_BUILD_NUMBER\n          value: $(tasks.get-version.results.BUILD_ID)\n      taskRef:\n        kind: Task\n        name: update-cbb\n      when:\n        - input: $(tasks.status)\n          operator: in\n          values:\n            - Succeeded\n"})})}),(0,i.jsx)(o.A,{value:"3.12",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="Pipeline"',children:"apiVersion: tekton.dev/v1\nkind: Pipeline\nmetadata:\n  labels:\n    app.edp.epam.com/pipelinetype: build\n    app.edp.epam.com/triggertemplate: github-build-template\n  name: custom-build-semver\nspec:\n  ...\n  finally:\n    - name: update-cbb\n      params:\n        - name: CODEBASEBRANCH_NAME\n          value: $(params.CODEBASEBRANCH_NAME)\n        - name: CURRENT_BUILD_NUMBER\n          value: $(tasks.get-version.results.BUILD_ID)\n      taskRef:\n        kind: Task\n        name: update-cbb\n      when:\n        - input: $(tasks.status)\n          operator: in\n          values:\n            - Succeeded\n            - Completed\n"})})})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Deploy Pipeline Parameters Renaming"}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["For detailed information about parameter changes in Tekton tasks, refer to the ",(0,i.jsx)(n.a,{href:"https://github.com/epam/edp-tekton/tree/master/charts/pipelines-library/templates/tasks",children:"edp-tekton"})," repository."]})}),"\n",(0,i.jsxs)(n.p,{children:["In version 3.12, the deprecated parameters ",(0,i.jsx)(n.code,{children:"PIPELINE"})," and ",(0,i.jsx)(n.code,{children:"STAGE"})," were ",(0,i.jsx)(n.a,{href:"https://github.com/epam/edp-tekton/issues/503",children:"renamed"})," in the Tekton tasks used in deployment pipelines to align with the KubeRocketCI portal naming conventions. Due to this change, it is necessary to update the passing parameters for the custom deploy pipelines that use the following Tekton tasks such as ",(0,i.jsx)(n.code,{children:"init-autotests"}),", ",(0,i.jsx)(n.code,{children:"clean"}),", ",(0,i.jsx)(n.code,{children:"deploy-ansible-awx"}),", ",(0,i.jsx)(n.code,{children:"deploy-ansible"}),", ",(0,i.jsx)(n.code,{children:"deploy-applicationset-cli"}),", ",(0,i.jsx)(n.code,{children:"run-quality-gate"}),", ",(0,i.jsx)(n.code,{children:"run-clean-gate"}),", ",(0,i.jsx)(n.code,{children:"sync-app"}),", and ",(0,i.jsx)(n.code,{children:"promote-images"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["For tasks such as ",(0,i.jsx)(n.code,{children:"run-clean-gate"}),", ",(0,i.jsx)(n.code,{children:"clean"}),", ",(0,i.jsx)(n.code,{children:"run-quality-gate"}),", ",(0,i.jsx)(n.code,{children:"deploy-ansible-awx"}),", ",(0,i.jsx)(n.code,{children:"deploy-ansible"}),", ",(0,i.jsx)(n.code,{children:"sync-app"}),", and ",(0,i.jsx)(n.code,{children:"deploy-applicationset-cli"}),", it is necessary to rename the passing parameters from ",(0,i.jsx)(n.code,{children:"PIPELINE"})," to ",(0,i.jsx)(n.code,{children:"DEPLOYMENT_FLOW"})," and from ",(0,i.jsx)(n.code,{children:"STAGE"})," to ",(0,i.jsx)(n.code,{children:"ENVIRONMENT"})," in the Tekton custom deploy pipelines as follows:"]}),"\n",(0,i.jsxs)(r.A,{defaultValue:"3.11",values:[{label:"3.11",value:"3.11"},{label:"3.12",value:"3.12"}],children:[(0,i.jsx)(o.A,{value:"3.11",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="Pipeline"',children:"apiVersion: tekton.dev/v1\nkind: Pipeline\nmetadata:\n  labels:\n    app.edp.epam.com/pipelinetype: deploy\n    app.edp.epam.com/triggertemplate: deploy\n  name: custom-deploy-pipeline\nspec:\n  ...\n  tasks:\n    - name: deploy-app\n      params:\n        - name: PIPELINE\n          value: $(params.CDPIPELINE)\n        - name: STAGE\n          value: $(params.CDSTAGE)\n        ...\n      taskRef:\n        kind: Task\n        name: deploy-applicationset-cli\n"})})}),(0,i.jsx)(o.A,{value:"3.12",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="Pipeline"',children:"apiVersion: tekton.dev/v1\nkind: Pipeline\nmetadata:\n  labels:\n    app.edp.epam.com/pipelinetype: deploy\n    app.edp.epam.com/triggertemplate: deploy\n  name: custom-deploy-pipeline\nspec:\n  ...\n  tasks:\n    - name: deploy-app\n      params:\n        - name: DEPLOYMENT_FLOW\n          value: $(params.CDPIPELINE)\n        - name: ENVIRONMENT\n          value: $(params.CDSTAGE)\n        ...\n      taskRef:\n        kind: Task\n        name: deploy-applicationset-cli\n"})})})]}),"\n",(0,i.jsxs)(n.p,{children:["For the ",(0,i.jsx)(n.code,{children:"init-autotests"})," task, it is necessary to rename the passing parameters from ",(0,i.jsx)(n.code,{children:"cd-pipeline-name"})," to ",(0,i.jsx)(n.code,{children:"DEPLOYMENT_FLOW"})," and from ",(0,i.jsx)(n.code,{children:"stage-name"})," to ",(0,i.jsx)(n.code,{children:"ENVIRONMENT"})," in the Tekton custom deploy pipelines as follows:"]}),"\n",(0,i.jsxs)(r.A,{defaultValue:"3.11",values:[{label:"3.11",value:"3.11"},{label:"3.12",value:"3.12"}],children:[(0,i.jsx)(o.A,{value:"3.11",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="Pipeline"',children:"apiVersion: tekton.dev/v1\nkind: Pipeline\nmetadata:\n  labels:\n    app.edp.epam.com/pipelinetype: deploy\n    app.edp.epam.com/triggertemplate: deploy\n  name: custom-deploy-pipeline\nspec:\n  ...\n  tasks:\n    - name: init-autotests\n      params:\n        - name: cd-pipeline-name\n          value: $(params.CDPIPELINE)\n        - name: stage-name\n          value: $(params.CDSTAGE)\n        ...\n      taskRef:\n        kind: Task\n        name: init-autotests\n"})})}),(0,i.jsx)(o.A,{value:"3.12",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="Pipeline"',children:"apiVersion: tekton.dev/v1\nkind: Pipeline\nmetadata:\n  labels:\n    app.edp.epam.com/pipelinetype: deploy\n    app.edp.epam.com/triggertemplate: deploy\n  name: custom-deploy-pipeline\nspec:\n  ...\n  tasks:\n    - name: init-autotests\n      params:\n        - name: DEPLOYMENT_FLOW\n          value: $(params.CDPIPELINE)\n        - name: ENVIRONMENT\n          value: $(params.CDSTAGE)\n        ...\n      taskRef:\n        kind: Task\n        name: init-autotests\n"})})})]}),"\n",(0,i.jsxs)(n.p,{children:["For the ",(0,i.jsx)(n.code,{children:"promote-images"})," task, it is necessary to rename the passing parameters from ",(0,i.jsx)(n.code,{children:"CDPIPELINE_CR"})," to ",(0,i.jsx)(n.code,{children:"DEPLOYMENT_FLOW"})," and from ",(0,i.jsx)(n.code,{children:"CDPIPELINE_STAGE"})," to ",(0,i.jsx)(n.code,{children:"ENVIRONMENT"})," in the Tekton custom deploy pipelines as follows:"]}),"\n",(0,i.jsxs)(r.A,{defaultValue:"3.11",values:[{label:"3.11",value:"3.11"},{label:"3.12",value:"3.12"}],children:[(0,i.jsx)(o.A,{value:"3.11",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="Pipeline"',children:"apiVersion: tekton.dev/v1\nkind: Pipeline\nmetadata:\n  labels:\n    app.edp.epam.com/pipelinetype: deploy\n    app.edp.epam.com/triggertemplate: deploy\n  name: custom-deploy-pipeline\nspec:\n  ...\n  tasks:\n    - name: promote-images\n      params:\n        - name: CDPIPELINE_CR\n          value: $(params.CDPIPELINE)\n        - name: CDPIPELINE_STAGE\n          value: $(params.CDSTAGE)\n        ...\n      taskRef:\n        kind: Task\n        name: promote-images\n"})})}),(0,i.jsx)(o.A,{value:"3.12",children:(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="Pipeline"',children:"apiVersion: tekton.dev/v1\nkind: Pipeline\nmetadata:\n  labels:\n    app.edp.epam.com/pipelinetype: deploy\n    app.edp.epam.com/triggertemplate: deploy\n  name: custom-deploy-pipeline\nspec:\n  ...\n  tasks:\n    - name: promote-images\n      params:\n        - name: DEPLOYMENT_FLOW\n          value: $(params.CDPIPELINE)\n        - name: ENVIRONMENT\n          value: $(params.CDSTAGE)\n        ...\n      taskRef:\n        kind: Task\n        name: promote-images\n"})})})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"(Optional) Enable Repository Discovery"}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["In case of using GitFusion with the Bitbucket Git provider, it is necessary to update the Bitbucket API token permissions to include the ",(0,i.jsx)(n.code,{children:"read:account"})," scope. For more details on how to create a Bitbucket app password with the required permissions, refer to the ",(0,i.jsx)(n.a,{href:"/docs/3.10/user-guide/add-git-server",children:"Add Git Server"})," guide."]})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["For more information about the GitFusion microservice, refer to the ",(0,i.jsx)(n.a,{href:"https://github.com/KubeRocketCI/gitfusion",children:"GitFusion"})," repository."]})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["For more details about KrakenD integration with KubeRocketCI, refer to the ",(0,i.jsx)(n.a,{href:"/docs/3.10/operator-guide/extensions/krakend",children:"KrakenD installation"})," guide."]})}),"\n",(0,i.jsxs)(n.p,{children:["Starting from version 3.12, KubeRocketCI supports integration with the ",(0,i.jsx)(n.a,{href:"https://github.com/KubeRocketCI/gitfusion",children:"GitFusion"})," microservice. This integration enables automatic discovery of repositories, branches, and organizations from various Git providers during the component or branch creation process in the KubeRocketCI portal. GitFusion act as a bridge between the KubeRocketCI portal and the Git provider, allowing the portal to access repository-related information without requiring direct access to the Git provider."]}),"\n",(0,i.jsx)(n.p,{children:"To enable the GitFusion integration in KubeRocketCI, follow the steps below:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Enable the GitFusion dependency in the ",(0,i.jsx)(n.code,{children:"values.yaml"})," file for ",(0,i.jsx)(n.code,{children:"edp-install"})," Helm chart by setting the ",(0,i.jsx)(n.code,{children:"gitfusion.enabled"})," parameter to ",(0,i.jsx)(n.code,{children:"true"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="values.yaml"',children:"gitfusion:\n  enabled: true\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Update the KrakenD configuration to include the GitFusion API endpoints."}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["The latest KrakenD configuration can be found in the ",(0,i.jsx)(n.a,{href:"https://github.com/epam/edp-cluster-add-ons/tree/main/clusters/core/addons/krakend",children:"edp-cluster-add-ons"})," repository."]})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Clone the forked ",(0,i.jsx)(n.a,{href:"https://github.com/epam/edp-cluster-add-ons",children:"edp-cluster-add-ons"})," repository."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Navigate to the ",(0,i.jsx)(n.code,{children:"clusters/core/addons/krakend"})," directory and update the ",(0,i.jsx)(n.code,{children:"values.yaml"})," file to include the GitFusion API endpoints:"]}),"\n",(0,i.jsxs)(a,{children:[(0,i.jsx)("summary",{children:(0,i.jsx)("b",{children:"values.yaml"})}),(0,i.jsxs)(n.p,{children:["Add new GitFusion API endpoints to the ",(0,i.jsx)(n.code,{children:"krakend.config"})," section:"]}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'krakend:\n  config: |\n    {\n      "$schema": "https://www.krakend.io/schema/krakend.json",\n      "version": 3,\n      "name": "KrakenD - API Gateway",\n      "timeout": "6000ms",\n      "cache_ttl": "300s",\n      "output_encoding": "json",\n      "client_tls": {\n        "@comment": "Skip SSL verification when connecting to backends",\n        "allow_insecure_connections": true\n      },\n      "extra_config": {\n        "router": {\n          "logger_skip_paths": [\n            "/__health"\n          ]\n        },\n        "auth/jwk-client": {\n            "@comment": "Enable a JWK shared cache amongst all endpoints of 60 minutes",\n            "shared_cache_duration": 3600\n        }\n      },\n      "endpoints": [\n        {\n          "endpoint": "/widgets/sonarqube/measures/component",\n          "method": "GET",\n          "output_encoding": "json",\n          "input_query_strings": [\n            "component",\n            "metricKeys"\n          ],\n          "extra_config": {\n            "auth/validator": {\n              "alg": "RS256",\n              "cache_duration": 3600,\n              "cache": true,\n              "disable_jwk_security": false,\n              "jwk_url": "{{ env "JWK_URL" }}"\n            }\n          },\n          "backend": [\n            {\n              "url_pattern": "/api/measures/component",\n              "encoding": "json",\n              "sd": "static",\n              "method": "GET",\n              "host": [\n                "{{ env "SONARQUBE_URL" }}"\n              ],\n              "extra_config": {\n                "qos/http-cache": {},\n                "modifier/martian": {\n                  "header.Append": {\n                    "scope": [\n                      "request"\n                    ],\n                    "name": "Authorization",\n                    "value": "Basic {{ env "SONARQUBE_TOKEN" }}"\n                  }\n                }\n              }\n            }\n          ]\n        },\n        {\n          "endpoint": "/widgets/deptrack/project",\n          "method": "GET",\n          "output_encoding": "json",\n          "input_query_strings": [\n            "name"\n          ],\n          "extra_config": {\n            "auth/validator": {\n              "alg": "RS256",\n              "cache_duration": 3600,\n              "cache": true,\n              "disable_jwk_security": false,\n              "jwk_url": "{{ env "JWK_URL" }}"\n            }\n          },\n          "backend": [\n            {\n              "url_pattern": "/api/v1/project",\n              "encoding": "json",\n              "sd": "static",\n              "method": "GET",\n              "host": [\n                "{{ env "DEPTRACK_URL" }}"\n              ],\n              "is_collection": true,\n              "extra_config": {\n                "qos/http-cache": {},\n                "modifier/martian": {\n                  "header.Append": {\n                    "scope": [\n                      "request"\n                    ],\n                    "name": "X-Api-Key",\n                    "value": "{{ env "DEPTRACK_TOKEN" }}"\n                  }\n                }\n              }\n            }\n          ]\n        },\n        {\n          "endpoint": "/widgets/deptrack/metrics/project/{uuid}/current",\n          "method": "GET",\n          "output_encoding": "json",\n          "input_query_strings": [\n            "name"\n          ],\n          "extra_config": {\n            "auth/validator": {\n              "alg": "RS256",\n              "cache_duration": 3600,\n              "cache": true,\n              "disable_jwk_security": false,\n              "jwk_url": "{{ env "JWK_URL" }}"\n            }\n          },\n          "backend": [\n            {\n              "url_pattern": "/api/v1/metrics/project/{uuid}/current",\n              "encoding": "json",\n              "sd": "static",\n              "method": "GET",\n              "host": [\n                "{{ env "DEPTRACK_URL" }}"\n              ],\n              "is_collection": false,\n              "extra_config": {\n                "qos/http-cache": {},\n                "modifier/martian": {\n                  "header.Append": {\n                    "scope": [\n                      "request"\n                    ],\n                    "name": "X-Api-Key",\n                    "value": "{{ env "DEPTRACK_TOKEN" }}"\n                  }\n                }\n              }\n            }\n          ]\n        },\n        {\n          "endpoint": "/search/logs",\n          "method": "POST",\n          "output_encoding": "json",\n          "extra_config": {\n            "auth/validator": {\n              "alg": "RS256",\n              "cache_duration": 3600,\n              "cache": true,\n              "disable_jwk_security": false,\n              "jwk_url": "{{ env "JWK_URL" }}"\n            }\n          },\n          "backend": [\n            {\n              "url_pattern": "/logstash-edp-*/_search",\n              "method": "POST",\n              "host": [\n                "{{ env "OPENSEARCH_URL" }}"\n              ],\n              "encoding": "json",\n              "extra_config": {\n                "qos/http-cache": {},\n                "modifier/martian": {\n                  "header.Append": {\n                    "scope": [\n                      "request"\n                    ],\n                    "name": "Authorization",\n                    "value": "Basic {{ env "OPENSEARCH_CREDS" }}"\n                  }\n                }\n              }\n            }\n          ]\n        },\n        {\n          "endpoint": "/gitfusion/repositories",\n          "method": "GET",\n          "input_query_strings": ["*"],\n          "output_encoding": "json",\n          "extra_config": {\n            "auth/validator": {\n              "alg": "RS256",\n              "cache_duration": 3600,\n              "cache": true,\n              "disable_jwk_security": false,\n              "jwk_url": "{{ env "JWK_URL" }}"\n            }\n          },\n          "backend": [\n            {\n              "url_pattern": "/api/v1/repositories",\n              "encoding": "json",\n              "sd": "static",\n              "method": "GET",\n              "host": [\n                "{{ env "GITFUSION_URL" }}"\n              ],\n              "extra_config": {\n                "qos/http-cache": {}\n              }\n            }\n          ]\n        },\n        {\n          "endpoint": "/gitfusion/repository",\n          "method": "GET",\n          "input_query_strings": ["*"],\n          "output_encoding": "json",\n          "extra_config": {\n            "auth/validator": {\n              "alg": "RS256",\n              "cache_duration": 3600,\n              "cache": true,\n              "disable_jwk_security": false,\n              "jwk_url": "{{ env "JWK_URL" }}"\n            }\n          },\n          "backend": [\n            {\n              "url_pattern": "/api/v1/repository",\n              "encoding": "json",\n              "sd": "static",\n              "method": "GET",\n              "host": [\n                "{{ env "GITFUSION_URL" }}"\n              ],\n              "extra_config": {\n                "qos/http-cache": {}\n              }\n            }\n          ]\n        },\n        {\n          "endpoint": "/gitfusion/organizations",\n          "method": "GET",\n          "input_query_strings": ["*"],\n          "output_encoding": "json",\n          "extra_config": {\n            "auth/validator": {\n              "alg": "RS256",\n              "cache_duration": 3600,\n              "cache": true,\n              "disable_jwk_security": false,\n              "jwk_url": "{{ env "JWK_URL" }}"\n            }\n          },\n          "backend": [\n            {\n              "url_pattern": "/api/v1/user/organizations",\n              "encoding": "json",\n              "sd": "static",\n              "method": "GET",\n              "host": [\n                "{{ env "GITFUSION_URL" }}"\n              ],\n              "extra_config": {\n                "qos/http-cache": {}\n              }\n            }\n          ]\n        },\n        {\n          "endpoint": "/gitfusion/branches",\n          "method": "GET",\n          "input_query_strings": ["*"],\n          "output_encoding": "json",\n          "extra_config": {\n            "auth/validator": {\n              "alg": "RS256",\n              "cache_duration": 3600,\n              "cache": true,\n              "disable_jwk_security": false,\n              "jwk_url": "{{ env "JWK_URL" }}"\n            }\n          },\n          "backend": [\n            {\n              "url_pattern": "/api/v1/branches",\n              "encoding": "json",\n              "sd": "static",\n              "method": "GET",\n              "host": [\n                "{{ env "GITFUSION_URL" }}"\n              ],\n              "extra_config": {\n                "qos/http-cache": {}\n              }\n            }\n          ]\n        },\n        {\n          "endpoint": "/gitfusion/invalidate",\n          "method": "POST",\n          "input_query_strings": ["*"],\n          "output_encoding": "json",\n          "extra_config": {\n            "auth/validator": {\n              "alg": "RS256",\n              "cache_duration": 3600,\n              "cache": true,\n              "disable_jwk_security": false,\n              "jwk_url": "{{ env "JWK_URL" }}"\n            }\n          },\n          "backend": [\n            {\n              "url_pattern": "/api/v1/cache/invalidate",\n              "encoding": "json",\n              "sd": "static",\n              "method": "DELETE",\n              "host": [\n                "{{ env "GITFUSION_URL" }}"\n              ],\n              "extra_config": {\n                "qos/http-cache": {}\n              }\n            }\n          ]\n        }\n      ]\n    }\n'})})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Update the KrakenD secret with the GitFusion URL variable."}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"GITFUSION_URL"})," variable should point to the GitFusion service URL, e.g., ",(0,i.jsx)(n.code,{children:"http://gitfusion.krci:8080"}),"."]})}),"\n",(0,i.jsxs)(n.p,{children:["Update the ",(0,i.jsx)(n.code,{children:"krakend"})," secret to include the ",(0,i.jsx)(n.code,{children:"GITFUSION_URL"})," variable:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="KrakenD secret"',children:"kind: Secret\napiVersion: v1\nmetadata:\n  name: krakend\n  namespace: krakend\ndata:\n  ...\n  GITFUSION_URL: http://gitfusion.krci:8080\ntype: Opaque\n"})}),"\n",(0,i.jsxs)(n.p,{children:["In case of using the External Secrets Operator with AWS Parameter Store, update the Parameter Store object to include the ",(0,i.jsx)(n.code,{children:"GITFUSION_URL"})," variable:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="AWS Parameter Store"',children:'{\n  "SONARQUBE_URL": "http://sonar.sonar:9000",\n  "SONARQUBE_TOKEN": "<sonarqube-token",\n  "DEPTRACK_URL": "http://dependency-track-api-server.dependency-track:8080",\n  "DEPTRACK_TOKEN": "<dependency-track-token>",\n  "JWK_URL": "https://keycloak.example.com/realms/<realmName>/protocol/openid-connect/certs",\n  "OPENSEARCH_URL": "https://opensearch-cluster-master.logging:9200",\n  "OPENSEARCH_CREDS": "opensearch-base64-encoded-credentials",\n  "GITFUSION_URL": "http://gitfusion.krci:8080"\n}\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Commit and push the changes to the ",(0,i.jsx)(n.code,{children:"edp-cluster-add-ons"})," repository. After the changes are pushed, navigate to the Argo CD and sync the KrakenD application to apply the updated configuration."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"After upgrading KubeRocketCI to version 3.12, the GitFusion microservice will be automatically used for repository discovery in the KubeRocketCI portal."}),"\n",(0,i.jsx)(n.p,{children:"Example of repository discovery in the KubeRocketCI portal during the component onboarding process:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"GitFusion",src:t(3483).A+"",width:"3364",height:"1574"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"(Optional) Align Remote Cluster Names"}),"\n",(0,i.jsx)(n.p,{children:"In case of using remote clusters in KubeRocketCI, it is necessary to update the remote cluster names in KubeRocketCI portal after upgrading to version 3.12."}),"\n",(0,i.jsxs)(n.p,{children:["After the upgrade, all remote cluster names will display as ",(0,i.jsx)(n.code,{children:"default-cluster"})," in the KubeRocketCI portal. This happens because starting from version 3.12, the portal retrieves cluster names from the ",(0,i.jsx)(n.code,{children:"kubeconfig"})," specification stored in the ",(0,i.jsx)(n.code,{children:"<cluster-name>"})," Kubernetes secret, where ",(0,i.jsx)(n.code,{children:"default-cluster"})," is the default name of the cluster in the ",(0,i.jsx)(n.code,{children:"kubeconfig"})," specification."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Remote Clusters",src:t(16509).A+"",width:"3364",height:"1666"})}),"\n",(0,i.jsx)(n.p,{children:"There are two ways to align the remote cluster names in the KubeRocketCI portal:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Recreate the remote cluster integration in the KubeRocketCI portal."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Navigate to the ",(0,i.jsx)(n.strong,{children:"Configuration"})," -> ",(0,i.jsx)(n.strong,{children:"Deployment"})," -> ",(0,i.jsx)(n.strong,{children:"Clusters"})," section in the KubeRocketCI portal."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Click on the cluster integration that needs to be updated and delete it by clicking the ",(0,i.jsx)(n.strong,{children:"Delete"})," (trash can) icon."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Delete Cluster",src:t(37635).A+"",width:"3334",height:"1666"})}),"\n",(0,i.jsx)(n.p,{children:"Confirm the deletion in the pop-up window."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["After the cluster integration is deleted, click the ",(0,i.jsx)(n.strong,{children:"Add Cluster"})," button to create a new cluster integration. Fill in the required fields and click the ",(0,i.jsx)(n.strong,{children:"Save"})," button to add the cluster."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Add Cluster",src:t(97211).A+"",width:"3364",height:"1666"})}),"\n",(0,i.jsx)(n.p,{children:"After the new cluster integration is created, the correct cluster name will be displayed in the KubeRocketCI portal."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Update the ",(0,i.jsx)(n.code,{children:"kubeconfig"})," specification in the ",(0,i.jsx)(n.code,{children:"<cluster-name>"})," Kubernetes secret."]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"<cluster-name>"})," secret is created automatically when a new cluster integration is added in the KubeRocketCI portal. The secret contains the ",(0,i.jsx)(n.code,{children:"kubeconfig"})," specification used to connect to the remote cluster."]})}),"\n",(0,i.jsxs)(n.p,{children:["It is also possible to update the ",(0,i.jsx)(n.code,{children:"kubeconfig"})," specification in the existing ",(0,i.jsx)(n.code,{children:"<cluster-name>"})," secret to change the cluster name, instead of recreating the cluster integration in the KubeRocketCI portal."]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Locate the ",(0,i.jsx)(n.code,{children:"<cluster-name>"})," secret in the namespace where KubeRocketCI is installed (e.g., ",(0,i.jsx)(n.code,{children:"krci"})," namespace)."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get secret <cluster-name> -n krci -o yaml\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Update the ",(0,i.jsx)(n.code,{children:"kubeconfig"})," specification by changing the ",(0,i.jsx)(n.code,{children:"clusters.name"})," and ",(0,i.jsx)(n.code,{children:"contexts.context.cluster"})," fields to match the desired cluster name."]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"data.config"})," field in the secret is base64 encoded. To update the ",(0,i.jsx)(n.code,{children:"kubeconfig"})," specification, decode the ",(0,i.jsx)(n.code,{children:"data.config"})," field, make the necessary changes, and then encode it back to base64 before updating the secret."]})}),"\n",(0,i.jsxs)(n.p,{children:["Example of the ",(0,i.jsx)(n.code,{children:"kubeconfig"})," specification in the ",(0,i.jsx)(n.code,{children:"<cluster-name>"})," secret:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="kubeconfig"',children:'{\n  "apiVersion": "v1",\n  "kind": "Config",\n  "current-context": "...",\n  "preferences": {},\n  "clusters": [\n    {\n      "cluster": {\n        "server": "...",\n        "certificate-authority-data": "..."\n      },\n      "name": "<cluster-name>" # Change this value to the desired cluster name\n    }\n  ],\n  "contexts": [\n    {\n      "context": {\n        "cluster": "<cluster-name>", # Change this value to the desired cluster name\n        "user": "..."\n      },\n      "name": "..."\n    }\n  ],\n  "users": [\n    {\n      "user": {\n        "token": "..."\n      },\n      "name": "..."\n    }\n  ]\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["After updating the ",(0,i.jsx)(n.code,{children:"kubeconfig"})," specification in the secret, the correct cluster name will be displayed in the KubeRocketCI portal."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"To upgrade KubeRocketCI to the v3.12, run the following commands:"}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["To verify the installation, it is possible to test the deployment before applying it to the cluster with the ",(0,i.jsx)(n.code,{children:"--dry-run"})," key:\n",(0,i.jsx)(n.code,{children:"helm upgrade krci epamedp/edp-install -n krci --values values.yaml --version=3.12.0 --dry-run"})]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm repo update epamedp\nhelm upgrade krci epamedp/edp-install -n krci --values values.yaml --version=3.12.0\n"})}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}function m(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},97211:(e,n,t)=>{t.d(n,{A:()=>a});const a=t.p+"assets/images/add-cluster-717f453a1d7e5792dea2d5d94a65b831.png"}}]);